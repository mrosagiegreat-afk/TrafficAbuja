<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <title>Dashboard | TrafficAbuja</title>
    <!-- META TAGS HERE: -->
<meta name="copyright" content="TrafficAbuja">
<meta name="description" content="TrafficAbuja community feed, Nigeria">
<meta name="author" content="TrafficAbuja">
<meta property="og:site_name" content="TrafficAbuja Feed">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    <style>
        /* ========== BASE STYLES ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-text-size-adjust: 100%;
            -moz-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            font-size: 16px;
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.5;
            color: #1a1a1a;
            background: #ffffff;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            height: 100%;
            overflow: hidden;
            position: relative;
            padding-bottom: env(safe-area-inset-bottom, 0);
        }

        /* ========== INVISIBLE SCROLLBARS ========== */
        ::-webkit-scrollbar {
            width: 0px;
            height: 0px;
            display: none;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: transparent;
        }

        * {
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        /* ========== SAFE AREA SUPPORT ========== */
        @supports (padding: max(0px)) {
            body, .bottom-nav {
                padding-left: max(env(safe-area-inset-left), 0px);
                padding-right: max(env(safe-area-inset-right), 0px);
            }
            
            .bottom-nav {
                padding-bottom: max(env(safe-area-inset-bottom), 12px);
            }
        }

        /* VERTICAL LEFT NAVIGATION (Instagram style) */
        .left-sidebar-nav {
            display: none;
            position: fixed;
            top: 0px;
            left: 20px;
            width: 220px;
            background: transparent;
            padding: 20px 0;
            z-index: 999;
        }

        /* Compact navigation for tablets */
.compact-sidebar-nav {
    display: none;
    position: fixed;
    top: 80px;
    left: 20px;
    width: 60px;
    backdrop-filter: blur(10px);
    padding: 20px 8px;
    border-radius: 16px;
    z-index: 999;
}

.left-nav-item {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 12px 16px;
    margin-bottom: 8px;
    text-decoration: none;
    color: #1a1a1a;
    font-size: 16px;
    font-weight: 500;
    border-radius: 8px;
    transition: all 0.2s ease;
    background: transparent;
    border: none;
    width: 100%;
    text-align: left;
    cursor: pointer;
    font-family: inherit;
    position: relative;
}

/* Compact version - icon only */
.compact-nav-item {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 12px;
    margin-bottom: 12px;
    text-decoration: none;
    color: #1a1a1a;
    font-size: 16px;
    border-radius: 12px;
    transition: all 0.2s ease;
    background: transparent;
    border: none;
    width: 44px;
    height: 44px;
    cursor: pointer;
    position: relative;
}

.left-nav-item:hover,
.compact-nav-item:hover {
    background: rgba(0, 0, 0, 0.05);
}

.left-nav-item.active,
.compact-nav-item.active {
    background: rgba(0, 0, 0, 0.08);
    font-weight: 600;
}

.left-nav-item i,
.compact-nav-item i {
    font-size: 20px;
    width: 24px;
    text-align: center;
}

/* Tooltip for compact navigation */
.compact-nav-item .nav-tooltip {
    position: absolute;
    left: 110%;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 6px 12px;
    border-radius: 6px;
    font-size: 12px;
    font-weight: 500;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s ease;
    z-index: 1000;
}

.compact-nav-item .nav-tooltip::before {
    content: '';
    position: absolute;
    left: -5px;
    top: 50%;
    transform: translateY(-50%);
    border-width: 5px;
    border-style: solid;
    border-color: transparent rgba(0, 0, 0, 0.8) transparent transparent;
}

.compact-nav-item:hover .nav-tooltip {
    opacity: 1;
}

/* Tablet / iPad (768px - 1024px) - CLEAN NO-BACKGROUND VERSION */
@media (min-width: 768px) and (max-width: 1024px) {
    .left-sidebar-nav {
        display: none;
    }
    
    .compact-sidebar-nav {
        display: block;
        width: 56px;
        background: transparent; /* NO BACKGROUND */
        backdrop-filter: none; /* NO BLUR */
        padding: 20px 4px;
        border-radius: 0; /* NO BORDER RADIUS */
        box-shadow: none; /* NO SHADOW */
        border: none; /* NO BORDER */
        left: 16px; /* Move slightly closer */
    }
    
    .compact-nav-item {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        margin-bottom: 16px;
        background: transparent; /* Keep transparent */
    }
    
    .compact-nav-item:hover {
        background: rgba(0, 0, 0, 0.05); /* Keep subtle hover */
    }
    
    .compact-nav-item.active {
        background: rgba(0, 0, 0, 0.08); /* Keep active state */
    }
    
    .compact-nav-item i {
        font-size: 22px;
        color: #1a1a1a;
    }
    
    /* Keep tooltip */
    .compact-nav-item .nav-tooltip {
        background: rgba(0, 0, 0, 0.85);
        padding: 8px 12px;
        font-size: 13px;
        border-radius: 8px;
    }
    
    .pill-navigation {
        gap: 6px;
    }
    
    .pill-btn {
        padding: 9px 16px;
        font-size: 13px;
    }
    
    .pill-btn i {
        font-size: 13px;
    }
    
    .bottom-nav {
        display: none;
    }
    
    .main-content {
        left: 80px; /* Slight adjustment */
        right: 0;
    }
}

/* Notification badge */
.notification-badge {
    position: absolute;
    top: 4px;
    right: 4px;
    background: #dc2626;
    color: white;
    font-size: 10px;
    min-width: 16px;
    height: 16px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0 4px;
    font-weight: 600;
}

/* For compact navigation, position differently */
.compact-nav-item .notification-badge {
    top: 6px;
    right: 6px;
    min-width: 14px;
    height: 14px;
    font-size: 9px;
}

/* ========== RESPONSIVE ADJUSTMENTS ========== */
/* Desktop (large screens) */
@media (min-width: 1025px) {
    .left-sidebar-nav {
        display: block;
    }
    
    .compact-sidebar-nav {
        display: none;
    }
    
    .pill-navigation {
        gap: 8px;
    }
    
    .pill-btn {
        padding: 10px 20px;
        font-size: 14px;
        gap: 8px;
    }
    
    .pill-btn i {
        font-size: 14px;
    }
    
    .bottom-nav {
        display: none;
    }
    
    .main-content {
        left: 260px;
        right: 0;
    }
}

/* Tablet / iPad (768px - 1024px) */
@media (min-width: 768px) and (max-width: 1024px) {
    .left-sidebar-nav {
        display: none;
    }
    
    .compact-sidebar-nav {
        display: block;
    }
    
    .pill-navigation {
        gap: 6px;
    }
    
    .pill-btn {
        padding: 9px 16px;
        font-size: 13px;
    }
    
    .pill-btn i {
        font-size: 13px;
    }
    
    .bottom-nav {
        display: none;
    }
    
    .main-content {
        left: 90px; /* Compact sidebar width + margin */
        right: 0;
    }
}

/* Mobile (below 768px) */
@media (max-width: 767px) {
    .left-sidebar-nav {
        display: none;
    }
    
    .compact-sidebar-nav {
        display: none;
    }
    
    .bottom-nav {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 70px;
        background: #ffffff;
        border-top: 1px solid #e0e0e0;
        z-index: 1000;
        display: flex;
        justify-content: space-around;
        align-items: center;
        padding-bottom: env(safe-area-inset-bottom, 12px);
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
    }
    
    .main-content {
        left: 0;
        right: 0;
        margin-bottom: 70px;
    }
    
    .page {
        padding-bottom: 0;
    }
    
    .pill-btn span {
        display: none;
    }
    
    .pill-btn {
        padding: 10px 12px;
    }
    
    .pill-btn i {
        font-size: 14px;
    }
}

/* Extra small phones */
@media (max-width: 400px) {
    .header {
        padding: 0 12px;
    }
    
    .logo {
        font-size: 18px;
    }
    
    .pill-navigation {
        gap: 4px;
    }
    
    .pill-btn {
        padding: 8px 10px;
    }
}

/* ========== CRITICAL FIX - MAIN CONTENT POSITION ========== */
/* Force main-content to be positioned for absolute children */
.main-content {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 70px !important;
    overflow: hidden !important;
    background: #ffffff !important;
    z-index: 1 !important;
}

/* Desktop */
@media (min-width: 769px) {
    .main-content {
        left: 260px !important;
    }
}

/* Tablet */
@media (min-width: 768px) and (max-width: 1024px) {
    .main-content {
        left: 80px !important;
    }
}

/* Mobile */
@media (max-width: 767px) {
    .main-content {
        left: 0 !important;
    }
}

/* Keep your page styles */
.page {
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    width: 100% !important;
    height: 100% !important;
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch !important;
    display: none !important;
    background: #ffffff !important;
}

.page.active {
    display: block !important;
}

/* ========== CENTERED CONTENT WITH MAX WIDTH ========== */
/* Keep the equal spacing but constrain content width */
@media (min-width: 769px) {
    .main-content {
        left: 260px !important;
        right: 0 !important; /* Keep right at 0 */
        width: auto !important;
    }
    
    /* Create a centered container inside each page */
    .page-content-container {
        max-width: 800px; /* Adjust this value as needed */
        margin: 0 auto;
        padding: 0 20px;
        box-sizing: border-box;
    }
    
    /* Apply to specific page contents */
    .profile-content,
    .updates-container,
    #ride-page > * {
        max-width: 800px;
        margin: 0 auto;
        padding: 0 20px;
        box-sizing: border-box;
    }
    
    /* For feed - Instagram-like centered feed */
    .feed-container {
        max-width: 600px; /* Instagram feed width */
        margin: 0 auto;
    }
}

/* Tablet */
@media (min-width: 768px) and (max-width: 1024px) {
    .main-content {
        left: 80px !important;
        right: 0 !important;
        width: auto !important;
    }
    
    .page-content-container,
    .profile-content,
    .updates-container,
    #ride-page > *,
    .feed-container {
        max-width: 600px;
        margin: 0 auto;
        padding: 0 20px;
        box-sizing: border-box;
    }
}

        /* ========== PAGES ========== */
        .page {
            display: none;
            height: 100%;
            width: 100%;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            background: #ffffff;
        }

        .page.active {
            display: block;
        }

        /* TrafficAbuja Feed */
#home-page {
    background: #ffffff;
    height: 100%;
    overflow-y: auto;
}

/* Pull to Refresh */
.pull-to-refresh {
    position: fixed;
    top: 60px;
    left: 0;
    width: 100%;
    z-index: 999;
    pointer-events: none;
    transition: transform 0.3s ease;
}

        .refresh-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px;
            color: #666;
            font-size: 14px;
            opacity: 0;
            transform: translateY(-100%);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .refresh-indicator.active {
            opacity: 1;
            transform: translateY(0);
        }

        .refresh-indicator i {
            margin-right: 8px;
            font-size: 16px;
        }

        /* New Post Notification */
        .new-post-notification {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%) translateY(-100%);
            background: #1a1a1a;
            color: white;
            padding: 12px 20px;
            border-radius: 24px;
            font-size: 14px;
            font-weight: 600;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0;
        }

        .new-post-notification.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .new-post-notification:hover {
            background: #333;
            transform: translateX(-50%) translateY(-2px);
        }

        /* TrafficAbuja Feed */
        .feed-container {
            padding-top: 5px;
            background: #ffffff;
        }

        /* TrafficAbuja Post */
        .post {
            background: #ffffff;
            margin-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .post-header {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            gap: 12px;
        }

        .post-avatar {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: linear-gradient(45deg, #030303, #050505);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 18px;
        }

        .post-user-info {
            flex: 1;
        }

        .post-username {
            font-weight: 600;
            color: #1a1a1a;
            font-size: 14px;
        }

        .post-time {
            font-size: 12px;
            color: #666;
            margin-top: 2px;
        }

        .post-more {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #666;
            border-radius: 50%;
            transition: background 0.2s ease;
        }

        .post-more:hover {
            background: #f0f0f0;
        }

        /* Post Media */
        .post-media {
            position: relative;
            width: 100%;
            background: #000;
        }

        .post-image {
            width: 100%;
            height: auto;
            display: block;
            background: #f0f0f0;
            min-height: 300px;
            object-fit: cover;
         position: relative; /* Add this line */
}

/* ADD THE WATERMARK CODE HERE: */
.post-image::after {
    content: 'TrafficAbuja';
    position: absolute;
    bottom: 10px;
    right: 10px;
    background: rgba(0, 0, 0, 0.5);
    color: white;
    padding: 2px 8px;
    border-radius: 3px;
    font-size: 10px;
    font-weight: 600;
    opacity: 0.7;
}
        .post-video {
            width: 100%;
            height: auto;
            display: block;
            background: #000;
            min-height: 300px;
        }

        .video-play-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }

        .video-play-btn:hover {
            background: rgba(0, 0, 0, 0.9);
            transform: translate(-50%, -50%) scale(1.1);
        }

        .video-play-btn i {
            font-size: 24px;
            margin-left: 3px;
        }

        /* Image Carousel */
        .carousel-container {
            position: relative;
            overflow: hidden;
        }

        .carousel-track {
            display: flex;
            transition: transform 0.5s ease;
        }

        .carousel-slide {
            min-width: 100%;
            position: relative;
        }

        .carousel-nav {
            position: absolute;
            top: 50%;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 10px;
            transform: translateY(-50%);
            pointer-events: none;
        }

              .carousel-btn {
    background: rgba(255, 255, 255, 0.5); /* 50% transparent */
    border: 1px solid rgba(255, 255, 255, 0.3); /* Add border for definition */
    width: 28px;
    height: 28px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    pointer-events: auto;
    transition: all 0.3s ease;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    backdrop-filter: blur(4px); /* Adds glass effect */
}

.carousel-btn i {
    font-size: 12px;
    color: rgba(0, 0, 0, 0.8); /* Slightly transparent icons */
}

.carousel-btn:hover {
    background: rgba(255, 255, 255, 0.8);
    border-color: rgba(255, 255, 255, 0.6);
    transform: scale(1.1);
}

        .carousel-dots {
            position: absolute;
            bottom: 15px;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 6px;
            pointer-events: none;
        }

        .carousel-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transition: all 0.3s ease;
        }

        .carousel-dot.active {
            background: white;
            transform: scale(1.2);
        }

        /* Post Actions */
        .post-actions {
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .post-action {
            background: none;
            border: none;
            color: #1a1a1a;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 4px;
        }

                /* Instagram-style spacing */
        .action-with-count {
            display: flex;
            align-items: center;
        }

        .action-count {
            font-size: 13px;
            font-weight: 600;
            color: #1a1a1a;
            margin-left: 2px; /* Space between icon and number */
        }

        .post-actions {
            padding: 12px 16px 8px;
            display: flex;
            align-items: center;
            gap: 15px; /* Instagram uses about 22px between action groups */
        }

        .post-action:hover {
            transform: scale(1.1);
        }

        .post-action.liked {
            color: #dc2626;
        }

        .post-action i {
            pointer-events: none;
        }

        /* Post Description */
        .post-description {
            padding: 0 16px 12px;
            font-size: 14px;
            line-height: 1.5;
            color: #1a1a1a;
        }

        .post-text {
            margin-bottom: 8px;
        }

        .post-text.collapsed {
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            text-overflow: ellipsis;
        }

        .read-more {
            color: #666;
            font-weight: 600;
            cursor: pointer;
            background: none;
            border: none;
            padding: 0;
            font-size: 14px;
        }

        .read-more:hover {
            color: #1a1a1a;
            text-decoration: underline;
        }

        .post-tags {
            margin-top: 8px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .post-tag {
            color: #00376b;
            font-weight: 600;
            text-decoration: none;
            font-size: 14px;
            cursor: pointer;
        }

        .post-tag:hover {
            text-decoration: underline;
        }

        /* Post Stats */
        .post-stats {
            padding: 0 16px 12px;
            font-size: 14px;
            color: #666;
        }

        .post-likes {
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 4px;
        }

        .post-time-stamp {
            font-size: 12px;
            text-transform: uppercase;
        }

        /* Share Notification Animation */
@keyframes fadeInOut {
    0% { opacity: 0; transform: translateX(-50%) translateY(20px); }
    20% { opacity: 1; transform: translateX(-50%) translateY(0); }
    80% { opacity: 1; transform: translateX(-50%) translateY(0); }
    100% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
}


        /* Post Modal */
        .post-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2002;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .post-modal.active {
            display: flex;
        }

        .post-modal-content {
            background: white;
            border-radius: 12px;
            width: 100%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease;
        }

        .post-modal-header {
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .post-modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #1a1a1a;
        }

        .close-post-btn {
            background: none;
            border: none;
            color: #666;
            font-size: 24px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s ease;
        }

        .close-post-btn:hover {
            background: #f0f0f0;
        }

        .post-modal-body {
            padding: 20px;
            font-size: 16px;
            line-height: 1.6;
            color: #1a1a1a;
        }

        .post-modal-body .post-text {
            margin-bottom: 0;
        }

        /* Empty State */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 60vh;
            padding: 40px;
            text-align: center;
            color: #666;
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #1a1a1a;
        }

        .empty-state p {
            font-size: 14px;
            line-height: 1.5;
            max-width: 300px;
        }


       /* ========== PROFILE PAGE STYLES (UNCHANGED) ========== */
.profile-header {
    padding: 25px 20px 20px;
    background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
    border-bottom: 1px solid #e0e0e0;
    margin-bottom: 1px;
}

.profile-greeting {
    font-size: 28px;
    font-weight: 700;
    margin-bottom: 8px;
    color: #1a1a1a;
}

/* ========== PROFILE META LINE ========== */
.profile-meta-line {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 8px;
    flex-wrap: wrap;
}

.profile-subtitle {
    font-size: 14px;
    color: #666;
    margin-bottom: 8px;
}

.profile-content {
    padding: 0;
}

        .profile-item {
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
            margin: 0;
        }

        .profile-item:last-child {
            border-bottom: none;
        }

        .profile-label {
            font-size: 12px;
            font-weight: 600;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }

        .profile-label::before {
            content: '';
            display: inline-block;
            width: 4px;
            height: 4px;
            background: #1a1a1a;
            border-radius: 50%;
            margin-right: 8px;
        }

        .profile-value {
            font-size: 16px;
            color: #1a1a1a;
            font-weight: 500;
            line-height: 1.5;
        }

        .beneficiary-display {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            border: 1px solid #e0e0e0;
        }

        .beneficiary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
        }

        .beneficiary-item:not(:last-child) {
            border-bottom: 1px solid #e0e0e0;
        }

        .beneficiary-info h4 {
            font-size: 16px;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 4px;
        }

        .beneficiary-info p {
            font-size: 14px;
            color: #666;
        }

        .beneficiary-tag {
            background: #e8f5e9;
            color: #4caf50;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .feedback-section {
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
            margin: 0;
            background: #f8f9fa;
        }

        .feedback-label {
            font-size: 12px;
            font-weight: 600;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
        }

        .feedback-label::before {
            content: '';
            display: inline-block;
            width: 4px;
            height: 4px;
            background: #1a1a1a;
            border-radius: 50%;
            margin-right: 8px;
        }

        .feedback-textarea {
            width: 100%;
            min-height: 100px;
            padding: 12px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            line-height: 1.5;
            resize: vertical;
            background: white;
            transition: all 0.3s ease;
            margin-bottom: 15px;
        }

        .feedback-textarea:focus {
            outline: none;
            border-color: #1a1a1a;
            box-shadow: 0 0 0 2px rgba(26, 26, 26, 0.1);
        }

        .feedback-textarea:disabled {
            background: #f0f0f0;
            cursor: not-allowed;
        }

        .send-btn {
            width: 100%;
            padding: 14px;
            background: #1a1a1a;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .send-btn:hover:not(:disabled) {
            background: #333;
            transform: translateY(-2px);
        }

        .send-btn:disabled {
            background: #e0e0e0;
            color: #888;
            cursor: not-allowed;
        }

        .send-note {
            font-size: 12px;
            color: #666;
            margin-top: 10px;
            text-align: center;
            font-style: italic;
        }

        .logout-section {
            padding: 20px;
            margin: 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .logout-btn {
            width: 100%;
            padding: 16px;
            background: #1a1a1a;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .logout-btn:hover {
            background: #333;
            transform: translateY(-2px);
        }

        .logout-note {
            font-size: 14px;
            color: #666;
            margin-top: 15px;
            text-align: center;
        }

        .status-message {
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 14px;
            text-align: center;
            display: none;
        }

        .status-success {
            background: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #c8e6c9;
            display: block;
        }

        .status-error {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ffcdd2;
            display: block;
        }

        .status-info {
            background: #e3f2fd;
            color: #1565c0;
            border: 1px solid #bbdefb;
            display: block;
        }

        /* ========== MOBILE BOTTOM NAVIGATION ========== */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 70px;
            background: #ffffff;
            border-top: 1px solid #e0e0e0;
            z-index: 1000;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding-bottom: env(safe-area-inset-bottom, 12px);
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
        }

        .mobile-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1;
            height: 100%;
            text-decoration: none;
            color: #666;
            transition: all 0.2s ease;
            -webkit-tap-highlight-color: transparent;
        }

        .mobile-nav-item.active {
            color: #1a1a1a;
        }

        .mobile-nav-icon {
            font-size: 20px;
            margin-bottom: 4px;
        }

        .mobile-nav-label {
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .mobile-nav-item.active .mobile-nav-label {
            font-weight: 600;
        }

        .mobile-nav-item.active::after {
            content: '';
            position: absolute;
            bottom: 8px;
            width: 4px;
            height: 4px;
            background: #1a1a1a;
            border-radius: 50%;
        }

        /* ========== VIEW PROFILE BUTTON ========== */
       .view-profile-btn {
    width: 100%;
    padding: 8px 0;
    margin: 8px 0 0 0;
    background: transparent;
    border: none;
    color: #000000;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: left;
    justify-content: left;
    gap: 4px;
}


        .view-profile-btn:hover {
            background: #f8f9fa;
            border-color: #1a1a1a;
        }

        .view-profile-btn:active {
            transform: scale(0.98);
        }

        /* ========== ORDER HISTORY SECTION ========== */
        .order-history-container {
            padding: 0;
        }

        .order-history-header {
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
            background: #f8f9fa;
        }

        .order-history-header h3 {
            font-size: 18px;
            font-weight: 700;
            color: #1a1a1a;
            margin: 0;
        }

        /* ========== ORDER FILTERS ========== */
        .order-filters {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid #e0e0e0;
            background: #ffffff;
            gap: 8px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .order-filter-btn {
            padding: 8px 16px;
            background: #f0f0f0;
            border: 1px solid #e0e0e0;
            border-radius: 20px;
            color: #666;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .order-filter-btn:hover {
            background: #e8e8e8;
            border-color: #ccc;
        }

        .order-filter-btn.active {
            background: #1a1a1a;
            color: white;
            border-color: #1a1a1a;
        }

        .filter-actions {
            margin-left: auto;
            flex-shrink: 0;
        }

        .filter-action-btn {
            padding: 8px 12px;
            background: transparent;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            color: #666;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .filter-action-btn:hover {
            background: #f0f0f0;
            border-color: #ccc;
        }

        /* ========== ORDERS TABLE ========== */
        .orders-table-wrapper {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .orders-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        .orders-table thead {
            background: #f8f9fa;
            border-bottom: 2px solid #e0e0e0;
        }

        .orders-table th {
            padding: 16px 20px;
            text-align: left;
            font-size: 12px;
            font-weight: 700;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .orders-table tbody tr {
            border-bottom: 1px solid #e0e0e0;
            transition: background 0.2s ease;
        }

        .orders-table tbody tr:hover {
            background: #f8f9fa;
        }

        .orders-table td {
            padding: 16px 20px;
            font-size: 14px;
            color: #1a1a1a;
        }

        .orders-table td:first-child {
            font-weight: 600;
            color: #1a1a1a;
        }

        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-align: center;
        }

        .status-badge.pending {
            background: #fff3cd;
            color: #ff9800;
            border: 1px solid #ffe0a3;
        }

        .status-badge.settled {
            background: #d4edda;
            color: #28a745;
            border: 1px solid #c3e6cb;
        }

        .status-badge.dispute {
            background: #f8d7da;
            color: #dc3545;
            border: 1px solid #f5c6cb;
        }

        .empty-orders-message {
            padding: 60px 20px;
            text-align: center;
            color: #888;
        }

        .empty-orders-message i {
            font-size: 48px;
            color: #ccc;
            display: block;
            margin-bottom: 16px;
        }

        .empty-orders-message p {
            font-size: 16px;
            margin: 0;
        }

        /* ========== PROFILE DETAIL VIEW STYLES ========== */
        .profile-detail-header {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border-bottom: 1px solid #e0e0e0;
            margin-bottom: 1px;
        }

        .back-btn {
            padding: 8px 12px;
            background: transparent;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            color: #1a1a1a;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .back-btn:hover {
            background: #f0f0f0;
            border-color: #1a1a1a;
        }

        .back-btn:active {
            transform: scale(0.98);
        }

        /* ========== RESPONSIVE ADJUSTMENTS ========== */
        @media (min-width: 769px) {
            .desktop-nav {
                display: flex;
                align-items: center;
            }
            
            .bottom-nav {
                display: none;
            }
            
            .main-content {
                bottom: 0;
                position: static;
                height: auto;
                min-height: calc(100vh - 60px);
                width: 100%;
            }
            
            .header {
                position: sticky;
                padding: 0 40px;
            }
            
            body {
                overflow: auto;
            }
            
            .feed-container {
                padding-top: 20px;
            }
            
            .feed-header {
                padding: 20px 40px;
            }
            
            .post {
                max-width: 600px;
                margin: 0 auto 30px auto;
                border: 1px solid #e0e0e0;
                border-radius: 12px;
                overflow: hidden;
            }
            
            .profile-header {
                padding: 40px 40px 30px;
            }
            
            .profile-content {
                max-width: 100%;
            }
            
            .profile-greeting {
                font-size: 32px;
            }
            
            .profile-item, .feedback-section, .logout-section {
                padding: 25px 40px;
            }
            
            .filter-tabs {
                padding: 0 40px;
            }
            
            .requests-list {
                padding: 0 40px;
            }
        }

        @media (max-width: 768px) {
            .desktop-nav {
                display: none;
            }
            
        }

        @media (max-width: 768px) and (orientation: landscape) {
            .bottom-nav {
                height: 60px;
            }
            
            .main-content {
                bottom: 60px;
            }
            
            .mobile-nav-label {
                display: none;
            }
            
            .mobile-nav-icon {
                font-size: 22px;
                margin-bottom: 0;
            }
        }

        html, body {
            max-width: 100%;
            overflow-x: hidden;
        }

        @supports (-webkit-touch-callout: none) {
            .bottom-nav {
                padding-bottom: max(env(safe-area-inset-bottom), 12px);
                height: calc(70px + env(safe-area-inset-bottom));
            }
            
            .main-content {
                height: calc(100vh - 60px - 70px - env(safe-area-inset-bottom));
            }
        }

        @media (max-height: 600px) {
            .bottom-nav {
                position: sticky;
                bottom: 0;
            }
        }
        /* Comment Modal */
        .comment-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2003;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .comment-modal-content {
            background: white;
            border-radius: 16px;
            width: 100%;
            max-width: 500px;
            max-height: 70vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .comment-modal-header {
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .comment-modal-header h3 {
            font-size: 18px;
            font-weight: 600;
            color: #1a1a1a;
            margin: 0;
        }

        .close-comment-btn {
            background: none;
            border: none;
            color: #666;
            font-size: 20px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s ease;
        }

        .close-comment-btn:hover {
            background: #f0f0f0;
        }

        .comment-modal-body {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .comments-list {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .comment-loading {
            text-align: center;
            color: #666;
            font-size: 14px;
            padding: 20px;
        }

        .comment-input-section {
            padding: 15px 20px;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        .comment-input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid #e0e0e0;
            border-radius: 20px;
            font-size: 14px;
            font-family: inherit;
            resize: none;
            min-height: 40px;
            max-height: 100px;
        }

        .comment-input:focus {
            outline: none;
            border-color: #1a1a1a;
        }

        .post-comment-btn {
            background: #1a1a1a;
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .post-comment-btn:hover {
            background: #333;
            transform: scale(1.1);
        }

        .post-comment-btn i {
            transform: rotate(-45deg);
        }

        /* Comment Items */
        .comment-item {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }

        .comment-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #1a1a1a;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
            flex-shrink: 0;
        }

        .comment-content {
            flex: 1;
        }

        .comment-author {
            font-weight: 600;
            color: #1a1a1a;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .comment-text {
            font-size: 14px;
            color: #1a1a1a;
            line-height: 1.4;
            margin-bottom: 4px;
        }

        .comment-time {
            font-size: 12px;
            color: #666;
        }

        /* ========== TOAST NOTIFICATION ========== */
        .double-tap-toast {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: #1a1a1a;
            color: white;
            padding: 14px 24px;
            border-radius: 50px;
            font-size: 14px;
            font-weight: 500;
            z-index: 998;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
            animation: slideUpToast 0.4s ease, slideDownToast 0.4s ease 2.6s forwards;
        }

        @keyframes slideUpToast {
            from { transform: translateX(-50%) translateY(100px); opacity: 0; }
            to { transform: translateX(-50%) translateY(0); opacity: 1; }
        }

        @keyframes slideDownToast {
            from { transform: translateX(-50%) translateY(0); opacity: 1; }
            to { transform: translateX(-50%) translateY(100px); opacity: 0; }
        }

        /* ========== LOADING STATE ========== */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeInOverlay 0.3s ease forwards;
        }

        @keyframes fadeInOverlay {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeOutOverlay {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        .loading-overlay.hide {
            animation: fadeOutOverlay 0.3s ease forwards;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(212, 12, 12, 0.2);
            border-top-color: #b41111;
            border-radius: 50%;
            animation: spinnerRotate 1s linear infinite;
        }

        @keyframes spinnerRotate {
            to { transform: rotate(360deg); }
        }

        .shop-panel {
            display: none;
            padding: 16px 20px 24px;
            background: #ffffff;
            min-height: 100vh;
        }

        #home-page .shop-panel.active {
            display: block;
        }

        #home-page .feed-container {
            margin-top: 0;
        }

        /* quick menu header */
        .nearby-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 20px 0 16px;
        }

        .nearby-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #1a2e3c;
            letter-spacing: -0.2px;
        }

        .nearby-setting-link {
            color: #a65a3a;
            font-size: 0.9rem;
            font-weight: 500;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 6px 14px;
            transition: background 0.2s;
        }

        .nearby-setting-link i {
            font-size: 0.8rem;
        }

        /* category carousel */
        .category-carousel {
            display: flex;
            gap: 20px;
            overflow-x: auto;
            padding: 8px 2px 20px;
            scrollbar-width: none;
            -webkit-overflow-scrolling: touch;
        }

        .category-carousel::-webkit-scrollbar {
            display: none;
        }

        .category-item {
            flex: 0 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 160px;
            user-select: none;
        }

        .category-item:hover {
            transform: translateY(-8px);
        }

        .location-card-container {
            background: #ffffff;
            border-radius: 20px;
            padding: 16px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.6);
            transition: all 0.3s ease;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .category-item:hover .location-card-container {
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.12);
            border-color: rgba(166, 90, 58, 0.2);
        }

        .category-circle {
            width: 130px;
            height: 130px;
            border-radius: 50%;
            background: #ffffff;
            border: 3px solid #ffffff;
            box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            background-size: cover;
            background-position: center;
            overflow: hidden;
            flex-shrink: 0;
            position: relative;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .circle-ring-outline {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.1), 0 0 20px rgba(0, 0, 0, 0.05);
            pointer-events: none;
        }

        .map-pin-icon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 2;
            font-size: 2.5rem;
            color: #dc2626;
            filter: drop-shadow(0 2px 8px rgba(220, 38, 38, 0.4));
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .location-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            gap: 8px;
        }

        .category-label {
            font-weight: 700;
            font-size: 1.05rem;
            color: #1a2e3c;
            text-align: center;
            line-height: 1.3;
            letter-spacing: -0.4px;
        }

        .divider-line {
            width: 40px;
            height: 1px;
            background: #e0e0e0;
            border: none;
        }

        .category-count {
            font-size: 0.8rem;
            color: #999;
            font-weight: 600;
            text-align: center;
            letter-spacing: 0.3px;
        }

        .category-item.active .location-card-container {
            box-shadow: 0 12px 32px rgba(166, 90, 58, 0.15);
            border-color: #a65a3a;
        }

        .category-content {
            margin-top: 15px;
            border-top: 1px solid #edf2f7;
            padding-top: 20px;
        }

        .category-sort-bar {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .category-sort-label {
            font-size: 16px;
            font-weight: 500;
            color: #1f2937;
        }

        .sort-control {
            position: relative;
            display: inline-flex;
            align-items: center;
        }

        .sort-trigger {
            background: none;
            border: none;
            padding: 0;
            display: inline-flex;
            align-items: center;
            gap: 7px;
            color: #111827;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            line-height: 1.2;
            font-family: inherit;
        }

        .sort-trigger i {
            color: #16a34a;
            font-size: 18px;
        }

        .sort-divider {
            color: #9ca3af;
            font-size: 14px;
        }

        .sort-dropdown-menu {
            position: absolute;
            top: calc(100% + 8px);
            left: 0;
            min-width: 210px;
            padding: 6px;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            background: #ffffff;
            box-shadow: 0 12px 26px rgba(0, 0, 0, 0.12);
            display: none;
            z-index: 30;
        }

        .sort-dropdown-menu.show {
            display: block;
        }

        .sort-option {
            width: 100%;
            border: none;
            background: transparent;
            text-align: left;
            padding: 9px 10px;
            font-size: 13px;
            color: #1f2937;
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
        }

        .sort-option:hover {
            background: #f3f4f6;
        }

        .sort-option.active {
            background: #ecfdf3;
            color: #065f46;
            font-weight: 600;
        }

        @media (max-width: 520px) {
            .category-sort-label {
                font-size: 15px;
            }

            .sort-trigger {
                font-size: 15px;
            }

            .sort-trigger i {
                font-size: 16px;
            }

            .sort-dropdown-menu {
                min-width: 190px;
            }
        }

        /* responsive: desktop grid layout */
        @media (min-width: 769px) {
            .category-carousel {
                display: flex;
                flex-wrap: wrap;
                gap: 16px;
                overflow: visible;
                padding: 8px 0 20px;
                justify-content: center;
                align-items: flex-start;
            }

            .category-item {
                flex: 0 0 calc(20% - 13px);
                width: auto;
                min-width: 140px;
            }
        }

        /* luxury card */
        .post-card {
            width: 100%;
            background: white;
            border-radius: 24px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            margin-bottom: 24px;
            transition: transform 0.2s;
            border: 1px solid #f0f3f8;
        }

        .post-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 35px rgba(0, 0, 0, 0.12);
        }

        .card-image {
            width: 100%;
            height: 200px;
            background-size: cover;
            background-position: center 25%;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: flex-start;
            padding: 14px 16px;
            color: white;
            text-shadow: 0 2px 8px rgba(0,0,0,0.5);
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
        }

        .watermark-brand {
            display: flex;
            align-items: center;
            gap: 6px;
            background: transparent;
            padding: 0;
            color: white;
            text-shadow: 0 1px 6px rgba(0,0,0,0.8);
            font-size: 0.85rem;
            align-self: flex-end;
        }

        .watermark-icon {
            width: 24px;
            height: 24px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.8rem;
            color: white;
            backdrop-filter: blur(2px);
            border: 1px solid rgba(255,255,255,0.3);
        }

        .verified-badge-water {
            color: #3897f0;
            font-size: 0.8rem;
        }

        .image-label {
            background: rgba(0, 0, 0, 0.35);
            backdrop-filter: blur(4px);
            padding: 4px 14px;
            border-radius: 40px;
            font-size: 0.8rem;
            border: 1px solid rgba(255,255,255,0.2);
            margin-top: auto;
        }

        .card-content {
            padding: 18px 18px 16px;
        }

        .datetime-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
            font-size: 0.85rem;
        }

        .date-muted {
            color: #6b6b6b;
            background: #f1f1f1;
            padding: 3px 10px;
            border-radius: 30px;
        }

        .urgent-badge {
            background: #e0d6d0;
            color: #3e2e23;
            padding: 3px 12px;
            border-radius: 50px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .event-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: #000;
        }

        .venue-row {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9rem;
            color: #2c2c2c;
            margin-bottom: 14px;
        }

        .venue-row i {
            color: #a65a3a;
            width: 18px;
        }

        .info-inline {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            margin-bottom: 16px;
            font-size: 0.9rem;
        }

        .info-inline span {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .info-inline i {
            color: #a65a3a;
            width: 18px;
        }

        .optional-indulgence {
            font-weight: 600;
            color: #a65a3a;
        }

        .pet-policy {
            font-weight: 600;
            color: #8b5e3c;
        }

        .info-inline .pet-policy i {
            color: #8b5e3c;
        }

        .transport-block {
            background: #f8f4f0;
            border-radius: 18px;
            padding: 14px 16px;
            margin: 10px 0 16px;
            position: relative;
        }

        .transport-title {
            font-weight: 600;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 6px;
            color: #1e2b2f;
            margin-bottom: 8px;
            width: calc(100% - 25px);
        }

        .transport-title i {
            color: #a65a3a;
        }

        .close-x {
            position: absolute;
            top: 12px;
            right: 14px;
            color: #8a7a6e;
            font-size: 1.2rem;
            font-weight: 300;
        }

        .transport-desc {
            font-size: 0.9rem;
            color: #2e2e2e;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .transport-desc i {
            color: #a65a3a;
        }

        .add-to-order-ribbon {
            background: #1e1e1e;
            color: white;
            font-weight: 600;
            padding: 14px 18px;
            border-radius: 18px;
            margin: 8px 0 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1rem;
        }

        .guest-limit {
            color: #f0e4d8;
            background: transparent;
            font-weight: 400;
            font-size: 0.9rem;
        }

        /* ========== MAP PAGE STYLES ========== */
        #map-page {
            display: flex;
            flex-direction: column;
            height: 100vh;
            background: #ffffff;
            overflow-x: hidden;
        }

        .map-control-panel {
            padding: 20px;
            background: #ffffff;
            border-bottom: 1px solid #eee;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .nearby-preferences-card {
            background: transparent;
            border: none;
            border-radius: 0;
            padding: 0;
            color: #111111;
            box-shadow: none;
        }

        .nearby-pref-section + .nearby-pref-section {
            margin-top: 16px;
        }

        .nearby-pref-title {
            margin: 0;
            font-size: 22px;
            font-weight: 700;
            color: #111111;
            letter-spacing: 0.01em;
        }

        .nearby-pref-subtitle {
            margin: 6px 0 0;
            font-size: 13px;
            color: #111111;
            line-height: 1.4;
        }

        .nearby-pref-chip-row {
            margin-top: 12px;
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .nearby-pref-chip {
            border: 1px solid #d7dde4;
            background: #f5f7fa;
            color: #111111;
            border-radius: 999px;
            padding: 11px 16px;
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            line-height: 1.25;
            white-space: nowrap;
            min-height: 48px;
            max-width: 100%;
            font-family: inherit;
        }

        .nearby-pref-chip-text {
            color: #111111;
            display: inline-block;
            line-height: 1.25;
        }

        .nearby-pref-edit-btn {
            width: auto;
            height: auto;
            border-radius: 0;
            border: none;
            background: transparent;
            color: #222222;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            flex-shrink: 0;
            padding: 0;
            transition: color 0.2s ease;
        }

        .nearby-pref-edit-btn:hover {
            background: transparent;
            color: #111111;
        }

        .nearby-pref-edit-btn i {
            font-size: 12px;
        }

        .nearby-pref-chip.editing {
            border-color: #9aa9b8;
            background: #ffffff;
        }

        .nearby-pref-chip-input {
            border: none;
            background: transparent;
            color: #111111;
            font-size: 16px;
            font-weight: 600;
            line-height: 1.25;
            outline: none;
            font-family: inherit;
            min-width: 90px;
            padding: 0 0 1px;
        }

        @media (max-width: 768px) {
            .nearby-pref-chip {
                font-size: 14px;
                padding: 10px 14px;
                min-height: 44px;
            }

            .nearby-pref-title {
                font-size: 19px;
            }

            .nearby-pref-chip-input {
                font-size: 14px;
            }
        }

        .location-search-section {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .search-input-group {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .location-search-input {
            flex: 1;
            padding: 12px 0;
            border: none;
            border-bottom: 2px solid #e0e0e0;
            font-size: 16px;
            outline: none;
            background: transparent;
            transition: border-color 0.3s ease;
            font-family: inherit;
        }

        .location-search-input::placeholder {
            color: #999;
        }

        .location-search-input:focus {
            border-bottom-color: #dc2626;
        }

        .geolocation-btn {
            width: 44px;
            height: 44px;
            border-radius: 8px;
            background: #f5f5f5;
            border: 1px solid #e0e0e0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #1a1a1a;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .geolocation-btn:hover {
            background: #efefef;
            border-color: #dc2626;
        }

        .radius-control-section {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .radius-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .radius-toggle-container {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            user-select: none;
        }

        .radius-toggle-checkbox {
            display: none;
        }

        .toggle-knob {
            width: 44px;
            height: 24px;
            background: #e0e0e0;
            border-radius: 12px;
            position: relative;
            transition: background-color 0.3s ease;
            flex-shrink: 0;
        }

        .toggle-knob::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: left 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .radius-toggle-checkbox:checked + .toggle-knob {
            background: #dc2626;
        }

        .radius-toggle-checkbox:checked + .toggle-knob::after {
            left: 22px;
        }

        .radius-label {
            font-weight: 600;
            font-size: 14px;
            color: #1a1a1a;
        }

        .radius-value-display {
            font-weight: 600;
            color: #dc2626;
            font-size: 14px;
        }

        .radius-slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(to right, #dc2626 0%, #dc2626 var(--percentage, 10%), #e0e0e0 var(--percentage, 10%), #e0e0e0 100%);
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            opacity: 1;
            pointer-events: auto;
            cursor: pointer;
            transition: opacity 0.3s ease;
        }

        .radius-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #dc2626;
            cursor: pointer;
            box-shadow: 0 0 8px rgba(220, 38, 38, 0.3);
        }

        .radius-slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #dc2626;
            cursor: pointer;
            border: none;
            box-shadow: 0 0 8px rgba(220, 38, 38, 0.3);
        }

        .map-container {
            flex: 1;
            width: calc(100% - 40px);
            max-width: calc(100% - 40px);
            min-width: 0;
            min-height: 400px;
            border-radius: 12px;
            margin: 20px auto;
            border: 1px solid #e0e0e0;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            z-index: 10;
            box-sizing: border-box;
        }

        @media (max-width: 768px) {
            .map-container {
                width: calc(100% - 24px);
                max-width: calc(100% - 24px);
                margin: 12px auto;
            }
        }

        /* Remove Leaflet default zoom controls */
        .leaflet-control-zoom {
            display: none !important;
        }

        /* Leaflet map tiles styling */
        .leaflet-tile {
            filter: grayscale(0%);
        }

        /* ========== CHAUFFEUR CARD STYLES ========== */
        #ride-page {
            position: relative;
            flex-direction: column;
        }

        #ride-page.active {
            display: flex !important;
        }

        .ride-canvas-spacer {
            flex: 1 1 auto;
            min-height: clamp(180px, 24vh, 300px);
            background: #ffffff;
            position: relative;
        }

        .ride-route-card {
            position: absolute;
            top: calc(env(safe-area-inset-top, 0px) + 92px);
            left: calc(env(safe-area-inset-left, 0px) + 14px);
            right: calc(env(safe-area-inset-right, 0px) + 14px);
            display: grid;
            grid-template-columns: 28px 1fr;
            align-items: start;
            column-gap: 14px;
            --ride-route-row-gap: 16px;
            max-width: none;
            width: auto;
            padding: 0;
            border-radius: 0;
            background: transparent;
            color: #111827;
            z-index: 12;
        }

        .ride-route-points {
            position: relative;
            width: 28px;
            display: grid;
            grid-template-rows: repeat(3, minmax(0, auto));
            row-gap: var(--ride-route-row-gap);
            justify-items: center;
            align-items: flex-start;
            padding: 2px 0;
        }

        .ride-route-points::before {
            content: "";
            position: absolute;
            top: 10px;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            background: radial-gradient(circle, rgba(17, 24, 39, 0.6) 1.2px, transparent 1.3px) center top / 4px 8px repeat-y;
        }

        .ride-route-dot {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            border: 3px solid #111827;
            z-index: 1;
            flex-shrink: 0;
        }

        .ride-route-dot-start {
            background: #ffffff;
            border-color: #111827;
        }

        .ride-route-dot-end {
            background: #ffffff;
            border-color: #ef4444;
        }

        .ride-route-texts {
            min-width: auto;
            max-width: 100%;
            display: grid;
            grid-template-rows: repeat(3, minmax(0, auto));
            row-gap: var(--ride-route-row-gap);
            word-break: normal;
            overflow-wrap: break-word;
        }

        .ride-route-line {
            font-size: clamp(14px, 1.5vw, 18px);
            line-height: 1.4;
            color: #111827;
            font-weight: 600;
            display: block;
            word-wrap: break-word;
            overflow-wrap: break-word;
            white-space: normal;
            min-height: auto;
            max-width: 100%;
        }

        .ride-route-line-edit {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ride-route-line-edit i {
            font-size: 0.82em;
            line-height: 1;
            color: #111827;
        }

        /* Desktop/tablet: keep route block edge-aligned and wide (not centered/cramped) */
        @media (min-width: 768px) {
            #ride-page > .ride-canvas-spacer {
                max-width: none !important;
                width: 100% !important;
                margin-left: 0 !important;
                margin-right: 0 !important;
                padding-left: 0 !important;
                padding-right: 0 !important;
            }

            .ride-route-card {
                left: calc(env(safe-area-inset-left, 0px) + 24px);
                width: min(980px, calc(100% - env(safe-area-inset-left, 0px) - env(safe-area-inset-right, 0px) - 48px));
                --ride-route-row-gap: 22px;
            }
        }

        .ride-top-strip {
            position: absolute;
            top: calc(env(safe-area-inset-top, 0px) + 16px);
            left: calc(env(safe-area-inset-left, 0px) + 22px);
            right: calc(env(safe-area-inset-right, 0px) + 22px);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            min-height: 44px;
            z-index: 14;
            padding-right: 12px;
        }

        .ride-invite-badge {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            padding: 0;
            background: transparent;
            color: #1f2937;
            font-size: clamp(14px, 1.8vw, 22px);
            font-weight: 700;
            letter-spacing: 0.1px;
            text-transform: none;
            line-height: 1;
            white-space: nowrap;
        }

        .ride-stage-shell {
            --ride-shell-pad-x: 24px;
            --ride-shell-pad-top: 9px;
            --ride-shell-pad-bottom: 12px;
            --ride-shell-pad-y-scale: 0.5;
            --ride-front-card-height: 355px;
            --ride-shell-height-boost: 60px;
            --ride-shell-radius: 50px;
            --ride-shell-shadow: 0 24px 52px rgba(15, 23, 42, 0.11), 0 8px 22px rgba(15, 23, 42, 0.07);
            position: relative;
            width: 100%;
            max-width: 705px;
            margin: 40px auto 60px;
            isolation: isolate;
            z-index: 11;
        }

        .ride-stage-shell::before {
            content: "";
            position: absolute;
            left: calc(var(--ride-shell-pad-x) * -1);
            right: calc(var(--ride-shell-pad-x) * -1);
            top: auto;
            bottom: calc(var(--ride-shell-pad-bottom) * -1 * var(--ride-shell-pad-y-scale));
            height: calc(var(--ride-front-card-height) + (var(--ride-shell-pad-top) + var(--ride-shell-pad-bottom)) * var(--ride-shell-pad-y-scale) + var(--ride-shell-height-boost));
            border-radius: var(--ride-shell-radius);
            background: #ffffff;
            border: 1px solid rgba(15, 23, 42, 0.05);
            box-shadow: var(--ride-shell-shadow);
            z-index: 0;
            pointer-events: none;
        }

        .ride-card-stage {
            position: relative;
            width: 100%;
            max-width: 705px;
            height: 560px;
            overflow: visible;
            margin: 0 auto;
            z-index: 1;
        }

        .ride-showcase-carousel {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: visible;
            cursor: grab;
            touch-action: pan-y;
            user-select: none;
        }

        .ride-showcase-carousel:active {
            cursor: grabbing;
        }

        .ride-showcase-slide {
            position: absolute;
            inset: 0;
            opacity: 0;
            transform: translateX(10px);
            transition: opacity 0.42s ease, transform 0.42s ease;
            pointer-events: none;
            z-index: 0;
        }

        .ride-showcase-slide.is-active {
            opacity: 1;
            transform: translateX(0);
            pointer-events: auto;
            z-index: 2;
        }

        .ride-showcase-dots {
            position: absolute;
            left: 50%;
            bottom: -16px;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 20;
        }

        .ride-showcase-dot {
            width: 9px;
            height: 9px;
            border-radius: 999px;
            border: none;
            background: rgba(15, 23, 42, 0.28);
            cursor: pointer;
            transition: width 0.22s ease, background-color 0.22s ease;
            padding: 0;
        }

        .ride-showcase-dot.is-active {
            width: 24px;
            background: #111827;
        }

        .ride-card {
            width: 100%;
            height: 355px;
            border-radius: 44px;
            background: #f8f8f8;
            position: absolute;
            bottom: 0;
            left: 0;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.76), inset 0 -18px 28px rgba(15, 23, 42, 0.06), 0 16px 34px rgba(15, 23, 42, 0.13);
            overflow: hidden;
        }

        /* soft premium sheen */
        .ride-card::before {
            content: "";
            position: absolute;
            inset: -45% -25% auto -25%;
            height: 75%;
            background: radial-gradient(closest-side, rgba(255,255,255,.22), rgba(255,255,255,0));
            pointer-events: none;
            z-index: 0;
        }

        .ride-heli-card {
            width: 100%;
            height: 355px;
            border-radius: 44px;
            position: absolute;
            bottom: 0;
            left: 0;
            background: linear-gradient(150deg, #eff7ff 0%, #e5eefc 45%, #ffffff 100%);
            border: 1px solid rgba(29, 78, 216, 0.16);
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.74), inset 0 -16px 24px rgba(30, 64, 175, 0.08), 0 14px 30px rgba(15, 23, 42, 0.12);
            overflow: hidden;
        }

        .ride-heli-card::before {
            content: "";
            position: absolute;
            inset: 0;
            background:
                radial-gradient(100% 120% at 90% 12%, rgba(37, 99, 235, 0.14), transparent 62%),
                linear-gradient(180deg, rgba(255, 255, 255, 0.62) 0%, rgba(255, 255, 255, 0) 60%);
            pointer-events: none;
        }

        .ride-heli-chip {
            position: absolute;
            left: 22px;
            bottom: 292px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 999px;
            background: #0f172a;
            color: #ffffff;
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 0.3px;
            z-index: 3;
        }

        .ride-heli-chip i {
            font-size: 12px;
        }

        .ride-heli-aircraft {
            position: absolute;
            left: 22px;
            bottom: 122px;
            display: flex;
            align-items: center;
            gap: 14px;
            z-index: 3;
            max-width: calc(100% - 44px);
        }

        .ride-heli-icon-wrap {
            width: 130px;
            height: 102px;
            border-radius: 24px;
            background: linear-gradient(145deg, #1d4ed8 0%, #60a5fa 100%);
            display: grid;
            place-items: center;
            box-shadow: 0 18px 32px rgba(29, 78, 216, 0.28);
            flex: 0 0 130px;
        }

        .ride-heli-icon-wrap i {
            font-size: 48px;
            color: #ffffff;
            transform: rotate(-8deg);
        }

        .ride-heli-aircraft-meta {
            min-width: 0;
        }

        .ride-heli-aircraft-title {
            font-size: clamp(22px, 2.1vw, 30px);
            line-height: 1.05;
            letter-spacing: 0.2px;
            color: #0f172a;
            font-weight: 800;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .ride-heli-aircraft-sub {
            margin-top: 8px;
            font-size: clamp(13px, 1.3vw, 17px);
            color: rgba(15, 23, 42, 0.7);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .ride-heli-passenger {
            position: absolute;
            right: 22px;
            bottom: 26px;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.78);
            border: 1px solid rgba(148, 163, 184, 0.38);
            z-index: 4;
            max-width: min(290px, 56%);
        }

        .ride-heli-avatar {
            width: 54px;
            height: 54px;
            border-radius: 50%;
            display: grid;
            place-items: center;
            font-weight: 800;
            color: #ffffff;
            background: linear-gradient(145deg, #0f172a, #334155);
            font-size: 18px;
            flex: 0 0 54px;
        }

        .ride-heli-passenger-meta {
            min-width: 0;
        }

        .ride-heli-passenger-name {
            font-size: 16px;
            line-height: 1.1;
            font-weight: 700;
            color: #111827;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .ride-heli-passenger-sub {
            margin-top: 6px;
            font-size: 12px;
            color: rgba(17, 24, 39, 0.65);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .ride-heli-footer {
            position: absolute;
            left: 22px;
            bottom: 24px;
            padding: 10px 14px;
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.78);
            border: 1px solid rgba(148, 163, 184, 0.36);
            font-size: 13px;
            color: rgba(15, 23, 42, 0.86);
            font-weight: 600;
            z-index: 3;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            max-width: calc(100% - 330px);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* IMAGES */
        .ride-person {
            position: absolute;
            right: 0px;
            bottom: 0;
            height: 395px;
            z-index: 5;
            object-fit: contain;
            pointer-events: none;
            filter: drop-shadow(0 18px 34px rgba(0,0,0,.18));
        }

        .ride-car {
            position: absolute;
            left: -26px;
            bottom: 8px;
            width: 470px;
            z-index: 2;
            object-fit: contain;
            pointer-events: none;
        }

        /* subtle light panel under car (keeps text readable, doesn't block car) */
        .ride-car-footer {
            position: absolute;
            left: 22px;
            bottom: 18px;
            width: 420px;
            padding: 14px 16px;
            border-radius: 18px;
            background: rgba(255,255,255,.72);
            border: 1px solid rgba(0,0,0,.06);
            box-shadow: 0 10px 24px rgba(0,0,0,.06);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            z-index: 3;
        }

        .ride-meta {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            color: rgba(0,0,0,.62);
            letter-spacing: .2px;
            line-height: 1.2;
            white-space: nowrap;
        }

        .ride-star {
            font-weight: 900;
            color: #111;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .ride-dot {
            opacity: .45;
        }

        .ride-meta-sub {
            margin-top: 6px;
            font-size: 14px;
            color: rgba(0,0,0,.62);
        }

        /* Plate number (premium small badge) */
        .ride-plate {
            position: absolute;
            left: 22px;
            bottom: 285px;
            z-index: 4;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
        }

        .ride-ng {
            width: 44px;
            height: 32px;
            border-radius: 10px;
            display: grid;
            place-items: center;
            background: linear-gradient(180deg, #1c7d3f, #0f5f2b);
            color: #fff;
            font-weight: 900;
            letter-spacing: .8px;
            font-size: 11px;
            text-transform: uppercase;
        }

        .ride-plate-text {
            display: flex;
            flex-direction: column;
            line-height: 1.05;
        }

        .ride-plate-code {
            font-weight: 950;
            letter-spacing: 2px;
            font-size: 14px;
            color: #111;
        }

        .ride-plate-city {
            margin-top: 3px;
            font-size: 10px;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: rgba(0,0,0,.5);
        }

        /* Ride quick communication actions (top-right icon-only) */
        .ride-quick-actions {
            position: relative;
            display: flex;
            align-items: center;
            gap: 18px;
            z-index: 1;
            max-width: none !important;
            margin: 0 0 0 auto !important;
            padding: 0 !important;
            flex: 0 0 auto;
        }

        .ride-quick-action-btn {
            width: auto;
            height: auto;
            border-radius: 0;
            border: none;
            background: transparent;
            color: #4b5563;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.2s ease, color 0.2s ease;
            box-shadow: none;
            padding: 4px;
        }

        .ride-quick-action-btn i {
            font-size: 19px;
        }

        .ride-quick-action-btn + .ride-quick-action-btn {
            margin-left: 0;
        }

        .ride-quick-action-btn + .ride-quick-action-btn::before {
            content: none;
        }

        .ride-quick-action-btn:hover {
            transform: translateY(-1px);
            color: #1f2937;
        }

        /* MOBILE RESPONSIVE - Keep car full size, don't compress */
        @media (max-width: 1100px) {
            .ride-stage-shell {
                max-width: 100%;
                --ride-shell-pad-x: 20px;
                --ride-shell-pad-top: 8px;
                --ride-shell-pad-bottom: 10px;
                --ride-shell-radius: 46px;
            }

            .ride-card-stage {
                max-width: 100%;
                height: 560px;
                padding: 0 14px;
            }

            .ride-card {
                width: 100%;
            }

            .ride-heli-card {
                width: 100%;
            }

            .ride-car {
                width: 360px;
                left: -18px;
                bottom: 10px;
            }

            .ride-car-footer {
                width: min(420px, 58%);
            }

            .ride-person {
                height: 350px;
                right: -6px;
            }

            .ride-heli-chip {
                bottom: 285px;
            }

            .ride-heli-aircraft {
                bottom: 116px;
                gap: 12px;
            }

            .ride-heli-icon-wrap {
                width: 118px;
                height: 94px;
                flex-basis: 118px;
            }

            .ride-heli-icon-wrap i {
                font-size: 42px;
            }

            .ride-heli-passenger {
                max-width: min(280px, 58%);
            }
        }

        /* Large phones (6+, Galaxy Plus) */
        @media (max-width: 820px) {
            .ride-top-strip {
                top: calc(env(safe-area-inset-top, 0px) + 14px);
                left: calc(env(safe-area-inset-left, 0px) + 18px);
                right: calc(env(safe-area-inset-right, 0px) + 18px);
                padding-right: 10px;
            }

            .ride-route-card {
                top: calc(env(safe-area-inset-top, 0px) + 86px);
                left: calc(env(safe-area-inset-left, 0px) + 12px);
                right: calc(env(safe-area-inset-right, 0px) + 12px);
                width: 100%;
                --ride-route-row-gap: 14px;
            }
            
            .ride-route-texts {
                min-width: 0;
            }
            
            .ride-route-line {
                font-size: clamp(13px, 2.5vw, 16px);
            }

            .ride-stage-shell {
                margin: 35px auto 45px;
                --ride-shell-pad-x: 18px;
                --ride-shell-pad-top: 7px;
                --ride-shell-pad-bottom: 9px;
                --ride-front-card-height: 315px;
                --ride-shell-radius: 42px;
            }

            .ride-card-stage {
                padding: 0 12px;
                height: 500px;
            }

            .ride-card {
                width: 100%;
                height: 315px;
            }

            .ride-heli-card {
                width: 100%;
                height: 315px;
                border-radius: 34px;
            }

            .ride-car {
                width: 340px;
                left: -16px;
                bottom: 9px;
            }

            .ride-car-footer {
                width: 60%;
                padding: 12px 14px;
            }

            .ride-person {
                height: 330px;
                right: -4px;
            }

            .ride-plate {
                bottom: 250px;
            }

            .ride-quick-actions {
                gap: 12px;
            }

            .ride-heli-chip {
                left: 18px;
                bottom: 258px;
                padding: 7px 11px;
                font-size: 11px;
            }

            .ride-heli-aircraft {
                left: 18px;
                bottom: 102px;
                max-width: calc(100% - 36px);
            }

            .ride-heli-icon-wrap {
                width: 106px;
                height: 86px;
                border-radius: 20px;
                flex-basis: 106px;
            }

            .ride-heli-icon-wrap i {
                font-size: 37px;
            }

            .ride-heli-aircraft-title {
                font-size: 21px;
            }

            .ride-heli-aircraft-sub {
                margin-top: 6px;
                font-size: 13px;
            }

            .ride-heli-passenger {
                right: 18px;
                bottom: 20px;
                max-width: 56%;
                padding: 9px 10px;
            }

            .ride-heli-avatar {
                width: 48px;
                height: 48px;
                flex-basis: 48px;
                font-size: 16px;
            }

            .ride-heli-passenger-name {
                font-size: 14px;
            }

            .ride-heli-passenger-sub {
                font-size: 11px;
                margin-top: 5px;
            }

            .ride-heli-footer {
                left: 18px;
                bottom: 19px;
                padding: 8px 11px;
                font-size: 12px;
                max-width: calc(100% - 240px);
            }

            .ride-showcase-dots {
                bottom: -12px;
            }
        }

        /* Medium phones (iPhone 12-14, Galaxy S20/S21) */
        @media (max-width: 768px) {
            .ride-route-card {
                column-gap: 12px;
                width: 100%;
                --ride-route-row-gap: 12px;
            }
            
            .ride-route-texts {
                min-width: 0;
            }
            
            .ride-route-line {
                font-size: clamp(13px, 3.5vw, 15px);
                line-height: 1.3;
            }
            
            .ride-stage-shell {
                margin: 32px auto 42px;
                --ride-shell-pad-x: 16px;
                --ride-shell-pad-top: 6px;
                --ride-shell-pad-bottom: 8px;
                --ride-front-card-height: 290px;
                --ride-shell-radius: 38px;
            }

            .ride-card-stage {
                padding: 0 11px;
                height: 460px;
            }

            .ride-card {
                height: 290px;
            }

            .ride-heli-card {
                height: 290px;
                border-radius: 32px;
            }

            .ride-car {
                width: 320px;
                left: -14px;
                bottom: 8px;
            }

            .ride-person {
                height: 310px;
                right: -3px;
            }

            .ride-plate {
                bottom: 228px;
            }

            .ride-quick-action-btn {
                padding: 3px;
            }

            .ride-quick-action-btn i {
                font-size: 18px;
            }

            .ride-heli-chip {
                bottom: 236px;
            }

            .ride-heli-aircraft {
                bottom: 96px;
                gap: 10px;
            }

            .ride-heli-icon-wrap {
                width: 96px;
                height: 78px;
                flex-basis: 96px;
            }

            .ride-heli-icon-wrap i {
                font-size: 34px;
            }

            .ride-heli-aircraft-title {
                font-size: 19px;
            }

            .ride-heli-aircraft-sub {
                font-size: 12px;
            }

            .ride-heli-passenger {
                max-width: 57%;
            }

            .ride-heli-footer {
                max-width: calc(100% - 220px);
            }
        }

        /* Small to Medium phones (iPhone 11, Galaxy S10) */
        @media (max-width: 600px) {
            .ride-top-strip {
                top: calc(env(safe-area-inset-top, 0px) + 12px);
                left: calc(env(safe-area-inset-left, 0px) + 14px);
                right: calc(env(safe-area-inset-right, 0px) + 14px);
                padding-right: 8px;
            }

            .ride-route-card {
                top: calc(env(safe-area-inset-top, 0px) + 82px);
                left: calc(env(safe-area-inset-left, 0px) + 10px);
                right: calc(env(safe-area-inset-right, 0px) + 10px);
                width: 100%;
                column-gap: 12px;
                --ride-route-row-gap: 12px;
            }
            
            .ride-route-texts {
                min-width: 0;
            }

            .ride-route-line {
                font-size: clamp(13px, 3.5vw, 15px);
                line-height: 1.3;
            }

            .ride-invite-badge {
                font-size: clamp(12px, 3.5vw, 18px);
                letter-spacing: 0.05px;
            }

            .ride-stage-shell {
                margin: 30px auto 40px;
                --ride-shell-pad-x: 14px;
                --ride-shell-pad-top: 6px;
                --ride-shell-pad-bottom: 7px;
                --ride-front-card-height: 280px;
                --ride-shell-radius: 34px;
            }

            .ride-card-stage {
                padding: 0 10px;
                height: 420px;
            }

            .ride-card {
                border-radius: 28px;
                height: 280px;
            }

            .ride-heli-card {
                border-radius: 28px;
                height: 280px;
            }

            .ride-car {
                width: 280px;
                left: -12px;
                bottom: 8px;
            }

            .ride-car-footer {
                width: 55%;
                padding: 10px 12px;
                bottom: 14px;
                left: 16px;
            }

            .ride-person {
                height: 260px;
                right: -4px;
            }

            .ride-meta {
                font-size: 12px;
            }

            .ride-meta-sub {
                font-size: 12px;
            }

            .ride-plate {
                bottom: 215px;
                left: 16px;
            }

            .ride-quick-actions {
                gap: 10px;
            }

            .ride-quick-action-btn {
                padding: 3px;
            }

            .ride-quick-action-btn i {
                font-size: 17px;
            }

            .ride-heli-chip {
                left: 16px;
                bottom: 228px;
                font-size: 10px;
                padding: 6px 10px;
            }

            .ride-heli-aircraft {
                left: 16px;
                bottom: 92px;
                max-width: calc(100% - 32px);
            }

            .ride-heli-icon-wrap {
                width: 90px;
                height: 72px;
                flex-basis: 90px;
                border-radius: 18px;
            }

            .ride-heli-icon-wrap i {
                font-size: 30px;
            }

            .ride-heli-aircraft-title {
                font-size: 17px;
            }

            .ride-heli-aircraft-sub {
                margin-top: 5px;
                font-size: 11px;
            }

            .ride-heli-passenger {
                right: 16px;
                bottom: 16px;
                max-width: 58%;
                padding: 8px 9px;
                border-radius: 14px;
            }

            .ride-heli-avatar {
                width: 42px;
                height: 42px;
                flex-basis: 42px;
                font-size: 14px;
            }

            .ride-heli-passenger-name {
                font-size: 13px;
            }

            .ride-heli-passenger-sub {
                font-size: 10px;
                margin-top: 4px;
            }

            .ride-heli-footer {
                left: 16px;
                bottom: 14px;
                padding: 7px 10px;
                font-size: 11px;
                border-radius: 12px;
                max-width: calc(100% - 202px);
            }

            .ride-showcase-dots {
                bottom: -10px;
            }
        }

        /* Extra small phones (iPhone SE, SE2, Galaxy A10) */
        @media (max-width: 480px) {
            .ride-route-card {
                top: calc(env(safe-area-inset-top, 0px) + 78px);
                left: calc(env(safe-area-inset-left, 0px) + 10px);
                right: calc(env(safe-area-inset-right, 0px) + 10px);
                width: 100%;
                column-gap: 11px;
                --ride-route-row-gap: 11px;
            }
            
            .ride-route-texts {
                min-width: 0;
            }

            .ride-route-line {
                font-size: clamp(12px, 3.5vw, 14px);
                line-height: 1.3;
            }

            .ride-stage-shell {
                margin: 25px auto 35px;
                --ride-shell-pad-x: 12px;
                --ride-shell-pad-top: 5px;
                --ride-shell-pad-bottom: 6px;
                --ride-front-card-height: 250px;
                --ride-shell-radius: 30px;
            }

            .ride-card-stage {
                padding: 0 8px;
                height: 380px;
            }

            .ride-card {
                border-radius: 24px;
                height: 250px;
            }

            .ride-heli-card {
                border-radius: 24px;
                height: 250px;
            }

            .ride-car {
                width: 250px;
                left: -10px;
                bottom: 6px;
            }

            .ride-car-footer {
                width: 52%;
                padding: 9px 11px;
                bottom: 12px;
                left: 14px;
                border-radius: 14px;
                font-size: 11px;
            }

            .ride-person {
                height: 240px;
                right: -2px;
            }

            .ride-meta {
                font-size: 11px;
                gap: 8px;
            }

            .ride-meta-sub {
                font-size: 11px;
                margin-top: 4px;
            }

            .ride-plate {
                bottom: 190px;
                left: 14px;
                gap: 8px;
                padding: 8px 10px;
            }

            .ride-ng {
                width: 40px;
                height: 28px;
                font-size: 10px;
            }

            .ride-plate-code {
                font-size: 12px;
            }

            .ride-plate-city {
                font-size: 9px;
            }

            .ride-heli-chip {
                left: 14px;
                bottom: 202px;
                font-size: 9px;
                padding: 5px 8px;
                gap: 6px;
            }

            .ride-heli-aircraft {
                left: 14px;
                bottom: 84px;
                gap: 8px;
                max-width: calc(100% - 28px);
            }

            .ride-heli-icon-wrap {
                width: 78px;
                height: 64px;
                flex-basis: 78px;
                border-radius: 16px;
            }

            .ride-heli-icon-wrap i {
                font-size: 25px;
            }

            .ride-heli-aircraft-title {
                font-size: 15px;
            }

            .ride-heli-aircraft-sub {
                font-size: 10px;
                margin-top: 4px;
            }

            .ride-heli-passenger {
                right: 14px;
                bottom: 12px;
                max-width: 60%;
                padding: 7px 8px;
                gap: 8px;
            }

            .ride-heli-avatar {
                width: 36px;
                height: 36px;
                flex-basis: 36px;
                font-size: 12px;
            }

            .ride-heli-passenger-name {
                font-size: 11px;
            }

            .ride-heli-passenger-sub {
                font-size: 9px;
                margin-top: 3px;
            }

            .ride-heli-footer {
                left: 14px;
                bottom: 11px;
                padding: 6px 8px;
                font-size: 10px;
                max-width: calc(100% - 184px);
            }
        }

        /* Ultra small phones (Galaxy Fold) */
        @media (max-width: 360px) {
            .ride-route-card {
                top: calc(env(safe-area-inset-top, 0px) + 76px);
                left: calc(env(safe-area-inset-left, 0px) + 8px);
                right: calc(env(safe-area-inset-right, 0px) + 8px);
                width: 100%;
                column-gap: 10px;
                --ride-route-row-gap: 10px;
            }
            
            .ride-route-texts {
                min-width: 0;
            }

            .ride-route-line {
                font-size: clamp(11px, 3.5vw, 13px);
                line-height: 1.25;
            }

            .ride-stage-shell {
                margin: 20px auto 30px;
                --ride-shell-pad-x: 10px;
                --ride-shell-pad-top: 4px;
                --ride-shell-pad-bottom: 5px;
                --ride-front-card-height: 230px;
                --ride-shell-radius: 26px;
            }

            .ride-card-stage {
                padding: 0 6px;
                height: 360px;
            }

            .ride-card {
                border-radius: 20px;
                height: 230px;
            }

            .ride-heli-card {
                border-radius: 20px;
                height: 230px;
            }

            .ride-car {
                width: 220px;
                left: -8px;
                bottom: 5px;
            }

            .ride-car-footer {
                width: 50%;
                padding: 8px 10px;
                bottom: 10px;
                left: 12px;
            }

            .ride-person {
                height: 220px;
                right: -1px;
            }

            .ride-plate {
                bottom: 175px;
                left: 12px;
            }

            .ride-heli-chip {
                left: 12px;
                bottom: 186px;
                font-size: 8px;
                padding: 4px 7px;
            }

            .ride-heli-aircraft {
                left: 12px;
                bottom: 78px;
            }

            .ride-heli-icon-wrap {
                width: 70px;
                height: 56px;
                flex-basis: 70px;
            }

            .ride-heli-icon-wrap i {
                font-size: 22px;
            }

            .ride-heli-aircraft-title {
                font-size: 13px;
            }

            .ride-heli-aircraft-sub {
                font-size: 9px;
            }

            .ride-heli-passenger {
                right: 12px;
                bottom: 10px;
                max-width: 61%;
                padding: 6px 7px;
            }

            .ride-heli-avatar {
                width: 32px;
                height: 32px;
                flex-basis: 32px;
                font-size: 11px;
            }

            .ride-heli-passenger-name {
                font-size: 10px;
            }

            .ride-heli-passenger-sub {
                font-size: 8px;
            }

            .ride-heli-footer {
                left: 12px;
                bottom: 9px;
                padding: 5px 7px;
                font-size: 9px;
                max-width: calc(100% - 165px);
            }

            .ride-showcase-dots {
                bottom: -8px;
            }
        }

        @media (min-width: 1025px) {
            .ride-route-card {
                left: calc(env(safe-area-inset-left, 0px) + 40px);
                right: calc(env(safe-area-inset-right, 0px) + 40px);
                column-gap: 18px;
                --ride-route-row-gap: 20px;
            }
            
            .ride-route-line {
                font-size: clamp(16px, 1.2vw, 20px);
                line-height: 1.5;
            }

            .ride-heli-aircraft-title {
                font-size: clamp(24px, 1.8vw, 32px);
            }

            .ride-heli-aircraft-sub {
                font-size: clamp(14px, 1vw, 18px);
            }
        }

        /* Mobile Ride card: keep layered depth while preserving compact spacing */
        @media (max-width: 767px) {
            .ride-canvas-spacer {
                min-height: 0;
            }

            .ride-stage-shell {
                margin: 22px auto 0 !important;
                --ride-shell-pad-x: 10px;
                --ride-shell-pad-top: 4px;
                --ride-shell-pad-bottom: 6px;
                --ride-shell-height-boost: 45px;
                --ride-shell-radius: 30px;
                --ride-shell-shadow: 0 18px 36px rgba(15, 23, 42, 0.11), 0 6px 16px rgba(15, 23, 42, 0.07);
            }

            .ride-card-stage {
                width: calc(100% - (var(--ride-shell-pad-x) * 2) - 20px);
                max-width: calc(100% - (var(--ride-shell-pad-x) * 2) - 20px);
                margin: 0 auto;
                padding: 0;
            }

            .ride-card,
            .ride-heli-card {
                border-radius: 30px 30px 0 0 !important;
                box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.76), inset 0 -12px 20px rgba(15, 23, 42, 0.05), 0 10px 22px rgba(15, 23, 42, 0.12) !important;
            }

            .ride-card {
                background: #ffffff;
            }

            .ride-card::before {
                content: none;
            }

            .ride-showcase-dots {
                bottom: 10px;
            }
        }

    </style>
</head>
<body>
    <!-- FULL VERTICAL LEFT SIDEBAR NAVIGATION (Desktop only) -->
    <div class="left-sidebar-nav">
        <a href="#" class="left-nav-item active" data-page="home">
            <i class="fas fa-compass"></i>
            <span>Discover</span>
        </a>
        
        <a href="#" class="left-nav-item" data-page="ride">
            <i class="fas fa-car"></i>
            <span>Ride</span>
        </a>
        
        <a href="#" class="left-nav-item" data-page="profile">
            <i class="fas fa-user"></i>
            <span>Profile</span>
        </a>
    </div>

    <!-- COMPACT VERTICAL SIDEBAR NAVIGATION (Tablet/iPad only) -->
    <div class="compact-sidebar-nav">
        <a href="#" class="compact-nav-item active" data-page="home">
            <i class="fas fa-compass"></i>
            <span class="nav-tooltip">Discover</span>
        </a>
        
        <a href="#" class="compact-nav-item" data-page="ride">
            <i class="fas fa-car"></i>
            <span class="nav-tooltip">Ride</span>
        </a>
        
        <a href="#" class="compact-nav-item" data-page="profile">
            <i class="fas fa-user"></i>
            <span class="nav-tooltip">Profile</span>
        </a>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Home Page - TrafficAbuja STYLE FEED -->
<div class="page active" id="home-page">
    <!-- Shop Panel -->
    <div class="shop-panel active" id="shopPanel">
        <div class="nearby-header">
            <span class="nearby-title">Nearby</span>
            <a href="#" class="nearby-setting-link">Settings <i class="fas fa-cog"></i></a>
        </div>
        <!-- category carousel (populated by JS) -->
        <div class="category-carousel" id="categoryCarousel"></div>
        <!-- dynamic content area -->
        <div class="category-content" id="categoryContent"></div>
    </div>

    <!-- Feed Panel -->
    <div class="shop-panel" id="feedPanel">
        <!-- Feed Container -->
        <div class="feed-container" id="feedContainer">
            <!-- Posts will be loaded here -->
            <div id="postsContainer"></div>
        </div>
    </div>
    
    <!-- Pull to Refresh Indicator -->
    <div class="pull-to-refresh">
        <div class="refresh-indicator" id="refreshIndicator">
            <i class="fas fa-spinner fa-spin"></i>
            Pull to refresh
        </div>
    </div>
    
    <!-- New Post Notification -->
    <div class="new-post-notification" id="newPostNotification">
        <i class="fas fa-sync-alt"></i>
        New posts available
    </div>
</div>

        <!-- Ride Page - Premium Chauffeur Card -->
        <div class="page" id="ride-page">
            <div class="ride-top-strip">
                <span class="ride-invite-badge">#INV-233-1125</span>

                <div class="ride-quick-actions" aria-label="Ride communication actions">
                    <button type="button" class="ride-quick-action-btn" id="ridePhoneBtn" aria-label="Phone call">
                        <i class="fas fa-phone"></i>
                    </button>
                    <button type="button" class="ride-quick-action-btn" id="rideVideoBtn" aria-label="Video call">
                        <i class="fas fa-video"></i>
                    </button>
                </div>
            </div>

            <div class="ride-canvas-spacer">
                <div class="ride-route-card" aria-label="Pickup and destination">
                    <div class="ride-route-points" aria-hidden="true">
                        <span class="ride-route-dot ride-route-dot-start"></span>
                        <span class="ride-route-dot ride-route-dot-start"></span>
                        <span class="ride-route-dot ride-route-dot-end"></span>
                    </div>
                    <div class="ride-route-texts">
                        <div class="ride-route-line ride-route-line-edit">59:59:59 <i class="fas fa-pen"></i></div>
                        <div class="ride-route-line ride-route-line-edit">Individualize <i class="fas fa-pen"></i></div>
                        <div class="ride-route-line">Olaya St, As Sahafah, Riyadh 13321</div>
                    </div>
                </div>
            </div>

            <div class="ride-stage-shell">
                <div class="ride-card-stage">
                    <div class="ride-showcase-carousel" id="rideShowcaseCarousel" aria-label="Ride style carousel">
                        <div class="ride-showcase-slide is-active" data-ride-slide="0">
                            <div class="ride-card"></div>

                            <!-- Plate number badge -->
                            <div class="ride-plate" aria-label="Plate number">
                                <div class="ride-ng">NG</div>
                                <div class="ride-plate-text">
                                    <div class="ride-plate-code">ABJ&nbsp;1432</div>
                                    <div class="ride-plate-city">Abuja</div>
                                </div>
                            </div>

                            <!-- Car footer text (bottom white area near car) -->
                            <div class="ride-car-footer">
                                <div class="ride-meta">
                                    <span class="ride-star">&#9733; 5.0</span>
                                    <span class="ride-dot">&#8226;</span>
                                    <span>Khalid Al-Mansoori</span>
                                </div>
                                <div class="ride-meta-sub">Business class &#8226; Ferrari purosangue</div>
                            </div>

                            <!-- Images -->
                            <img src="file2.png" class="ride-car" alt="Car Image" />
                            <img src="file1.png" class="ride-person" alt="Person Image" />
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Map View Page -->
        <div class="page" id="map-page">
            <!-- Back Button -->
            <div style="padding: 20px; border-bottom: 1px solid #eee; display: flex; align-items: center; gap: 12px;">
                <button id="backFromMapBtn" style="background: none; border: 1px solid #e0e0e0; width: 40px; height: 40px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; color: #1a1a1a; font-size: 18px;">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h2 style="margin: 0; font-size: 22px; font-weight: 600; color: #1a1a1a;">Back</h2>
            </div>

            <!-- Location Control Panel -->
            <div class="map-control-panel">
                <div class="nearby-preferences-card" id="nearbyPreferenceCard">
                    <div class="nearby-pref-section">
                        <h3 class="nearby-pref-title">What you want to see more of</h3>
                        <p class="nearby-pref-subtitle">Based on your activity, summarized by AI</p>
                        <div class="nearby-pref-chip-row">
                            <div class="nearby-pref-chip">
                                <span class="nearby-pref-chip-text">Business Ownership</span>
                                <button type="button" class="nearby-pref-edit-btn" aria-label="Edit preference">
                                    <i class="fas fa-pen"></i>
                                </button>
                            </div>
                            <div class="nearby-pref-chip">
                                <span class="nearby-pref-chip-text">Private Equity</span>
                                <button type="button" class="nearby-pref-edit-btn" aria-label="Edit preference">
                                    <i class="fas fa-pen"></i>
                                </button>
                            </div>
                            <div class="nearby-pref-chip">
                                <span class="nearby-pref-chip-text">Digital Marketing</span>
                                <button type="button" class="nearby-pref-edit-btn" aria-label="Edit preference">
                                    <i class="fas fa-pen"></i>
                                </button>
                            </div>
                            <div class="nearby-pref-chip">
                                <span class="nearby-pref-chip-text">Influencer Marketing</span>
                                <button type="button" class="nearby-pref-edit-btn" aria-label="Edit preference">
                                    <i class="fas fa-pen"></i>
                                </button>
                            </div>
                            <div class="nearby-pref-chip">
                                <span class="nearby-pref-chip-text">Billions</span>
                                <button type="button" class="nearby-pref-edit-btn" aria-label="Edit preference">
                                    <i class="fas fa-pen"></i>
                                </button>
                            </div>
                            <div class="nearby-pref-chip">
                                <span class="nearby-pref-chip-text">Flexibility</span>
                                <button type="button" class="nearby-pref-edit-btn" aria-label="Edit preference">
                                    <i class="fas fa-pen"></i>
                                </button>
                            </div>
                            <div class="nearby-pref-chip">
                                <span class="nearby-pref-chip-text">Company</span>
                                <button type="button" class="nearby-pref-edit-btn" aria-label="Edit preference">
                                    <i class="fas fa-pen"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Location Search Section -->
                <div class="location-search-section">
                    <div class="search-input-group">
                        <input type="text" id="locationSearch" class="location-search-input" placeholder="Search location...">
                        <button id="geolocateBtn" class="geolocation-btn" title="Use my location">
                            <i class="fas fa-location-dot"></i>
                        </button>
                    </div>
                </div>

                <!-- Radius Control Section -->
                <div class="radius-control-section">
                    <input type="range" id="radiusSlider" class="radius-slider" min="0.5" max="10" step="0.5" value="1">
                </div>
            </div>

            <!-- Map Container -->
            <div id="map-container" class="map-container"></div>

            <!-- Placeholder for future content above map -->
            <div style="display: none;" id="mapPageFutureContent"></div>
        </div>

        <!-- Profile Page - UNCHANGED -->
        <div class="page" id="profile-page">
            <!-- Profile Header - SIMPLIFIED -->
            <div class="profile-header">
                <!-- User Greeting -->
                <div class="profile-greeting" id="userGreeting">Hi, Welcome </div>
                
                <!-- Member since ONLY -->
<div class="profile-meta-line">
    <span class="member-since" id="memberSince">Member since: Loading...</span>
</div>
                
                <!-- View Profile Button -->
                <button class="view-profile-btn" id="viewProfileBtn">
                    <span>View Profile</span>
                </button>
                
                <p class="profile-subtitle">Contact TrafficAbuja to update your information.</p>                
            </div>

            <!-- Invite History Section -->
            <div class="order-history-container">
                <div class="order-history-header">
                    <h3>Invite History</h3>
                </div>
                
                <!-- Order Status Filters -->
                <div class="order-filters">
                    <button class="order-filter-btn active" data-filter="all">All</button>
                    <button class="order-filter-btn" data-filter="settled">Settled</button>
                    <button class="order-filter-btn" data-filter="pending">Pending</button>
                    <button class="order-filter-btn" data-filter="dispute">Dispute</button>
                    <div class="filter-actions">
                        <button class="filter-action-btn" title="Action options">
                            <i class="fas fa-code"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Orders Table -->
                <div class="orders-table-wrapper">
                    <table class="orders-table">
                        <thead>
                            <tr>
                                <th>Invite #</th>
                                <th>Date</th>
                                <th>Payment Status</th>
                                <th>Total Cost</th>
                            </tr>
                        </thead>
                        <tbody id="ordersTableBody">
                            <!-- Orders will be inserted here -->
                        </tbody>
                    </table>
                </div>
                
                <div class="empty-orders-message" id="emptyOrdersMessage" style="display: none;">
                    <i class="fas fa-box-open"></i>
                    <p>No invites found</p>
                </div>
            </div>
        </div>

        <!-- Profile Detail Page (Full page view) -->
        <div class="page" id="profile-detail-page" style="display: none;">
            <!-- Profile Detail Header with Back Button -->
            <div class="profile-header profile-detail-header">
                <button class="back-btn" id="backFromProfileBtn">
                    <i class="fas fa-arrow-left"></i>
                    <span>Back</span>
                </button>
                <div class="profile-greeting" id="userGreetingDetail">Hi, Welcome </div>
            </div>

            <!-- Profile Content (Detailed View) -->
            <div class="profile-content">
                <!-- Personal Information -->
                <div class="profile-item">
                    <div class="profile-label">Name</div>
                    <div class="profile-value" id="profileName">Loading...</div>
                </div>
                
                <div class="profile-item">
                    <div class="profile-label">Phone Number</div>
                    <div class="profile-value" id="profilePhone">Loading...</div>
                </div>
                
                <div class="profile-item">
                    <div class="profile-label">Address</div>
                    <div class="profile-value" id="profileAddress">Loading...</div>
                </div>
                
                <div class="profile-item">
                    <div class="profile-label">Education</div>
                    <div class="profile-value" id="profileEducation">Loading...</div>
                </div>
                
                <!-- Beneficiary -->
                <div class="profile-item">
                    <div class="profile-label">Beneficiary</div>
                    <div class="profile-value" id="profileBeneficiary">
                        Loading...
                    </div>
                </div>
                
                <!-- Primary Account -->
                <div class="profile-item">
                    <div class="profile-label">Primary Account</div>
                    <div class="profile-value" id="profileAccount">
                        Loading...
                    </div>
                </div>
                
                <!-- Feedback Section -->
                <div class="feedback-section">
                    <div class="feedback-label">Feedback</div>
                    <textarea class="feedback-textarea" id="feedbackTextarea" placeholder="Type your feedback here..."></textarea>
                    
                    <!-- Status Message -->
                    <div class="status-message" id="statusMessage"></div>
                    
                    <button class="send-btn" id="sendBtn" disabled>
                        <i class="fas fa-paper-plane"></i>
                        <span>Send</span>
                    </button>
                    
                    <div class="send-note" id="sendNote">
                        Send button activates when you complete a new event
                    </div>
                </div>
                
                <!-- Logout Section -->
                <div class="logout-section">
                    <button class="logout-btn" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Logout</span>
                    </button>
                    <p class="logout-note">You'll be redirected to the main page</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Bottom Navigation -->
    <div class="bottom-nav">
        <a href="#" class="mobile-nav-item active" data-page="home">
            <i class="fas fa-compass mobile-nav-icon"></i>
            <span class="mobile-nav-label">Discover</span>
        </a>
        
        <a href="#" class="mobile-nav-item" data-page="ride">
            <i class="fas fa-car mobile-nav-icon"></i>
            <span class="mobile-nav-label">Ride</span>
        </a>
        
        <a href="#" class="mobile-nav-item" data-page="profile">
            <i class="fas fa-user mobile-nav-icon"></i>
            <span class="mobile-nav-label">You</span>
        </a>
    </div>

    <!-- Post Modal -->
    <div class="post-modal" id="postModal">
        <div class="post-modal-content">
            <div class="post-modal-header">
                <div class="post-modal-title">Post Details</div>
                <button class="close-post-btn" id="closePostBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="post-modal-body" id="postModalBody">
                <!-- Full post text will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        // ========== SUPABASE CONFIGURATION ==========
        const SUPABASE_URL = 'https://qoisqrzlfspzxtnkgyyr.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFvaXNxcnpsZnNwenh0bmtneXlyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY4MDA0MzMsImV4cCI6MjA4MjM3NjQzM30.jp97VkUx6IFARFzFw3YXJJfBZmdnnCPHM95Q1WAqHnc';
        
        // Initialize Supabase client
        let supabaseClient = null;
        
        try {
            if (typeof supabase !== 'undefined') {
                supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
                    auth: {
                        persistSession: true
                    }
                });
            }
        } catch (error) {
            console.warn('Supabase initialization failed:', error);
        }
        
        // ========== GLOBAL VARIABLES ==========
        let currentAssociate = null;
        let hasSentFeedback = false;
        
        // Feed Variables
        let posts = [];
        let newPostsAvailable = false;
        let pullStartY = 0;
        let pullDistance = 0;
        let isRefreshing = false;
        let likedPosts = new Set();
        let savedPosts = new Set();
        // ========== DOM ELEMENTS ==========
        const sendBtn = document.getElementById('sendBtn');
        const feedbackTextarea = document.getElementById('feedbackTextarea');
        const statusMessage = document.getElementById('statusMessage');
        const sendNote = document.getElementById('sendNote');
        const postModal = document.getElementById('postModal');
        const closePostBtn = document.getElementById('closePostBtn');
        const postModalBody = document.getElementById('postModalBody');
        const refreshIndicator = document.getElementById('refreshIndicator');
        const newPostNotification = document.getElementById('newPostNotification');
        const postsContainer = document.getElementById('postsContainer');
        
        // ========== NAVIGATION HANDLING ==========
document.addEventListener('DOMContentLoaded', function() {
    initNavigation();
    initPostModal();
    initRideShowcaseCarousel();
    loadAssociateData();
    initTrafficabujaFeed();
    initializeOrderHistory();
    initMapPage();
});

function initRideShowcaseCarousel() {
    const carousel = document.getElementById('rideShowcaseCarousel');
    if (!carousel) return;

    const slides = Array.from(carousel.querySelectorAll('.ride-showcase-slide'));
    const dots = Array.from(document.querySelectorAll('.ride-showcase-dot'));
    if (slides.length === 0) return;
    if (slides.length === 1) {
        slides[0].classList.add('is-active');
        slides[0].setAttribute('aria-hidden', 'false');
        return;
    }

    const autoIntervalMs = 5000;
    const swipeThreshold = 40;
    let currentSlideIndex = 0;
    let autoplayId = null;
    let touchStartX = 0;
    let touchStartY = 0;
    let isTouchTracking = false;
    let mouseStartX = 0;
    let mouseStartY = 0;
    let isMouseTracking = false;

    function showSlide(index) {
        const total = slides.length;
        currentSlideIndex = ((index % total) + total) % total;

        slides.forEach((slide, slideIndex) => {
            const isActive = slideIndex === currentSlideIndex;
            slide.classList.toggle('is-active', isActive);
            slide.setAttribute('aria-hidden', isActive ? 'false' : 'true');
        });

        dots.forEach((dot, dotIndex) => {
            const isActive = dotIndex === currentSlideIndex;
            dot.classList.toggle('is-active', isActive);
            dot.setAttribute('aria-selected', isActive ? 'true' : 'false');
        });
    }

    function goNext() {
        showSlide(currentSlideIndex + 1);
    }

    function restartAutoplay() {
        if (autoplayId) {
            clearInterval(autoplayId);
        }
        autoplayId = setInterval(goNext, autoIntervalMs);
    }

    function stopAutoplay() {
        if (!autoplayId) return;
        clearInterval(autoplayId);
        autoplayId = null;
    }

    function applySwipe(deltaX, deltaY) {
        if (Math.abs(deltaX) < swipeThreshold) return false;
        if (Math.abs(deltaX) <= Math.abs(deltaY)) return false;

        if (deltaX < 0) {
            showSlide(currentSlideIndex + 1);
        } else {
            showSlide(currentSlideIndex - 1);
        }

        restartAutoplay();
        return true;
    }

    dots.forEach((dot, dotIndex) => {
        dot.setAttribute('role', 'tab');
        dot.addEventListener('click', () => {
            showSlide(dotIndex);
            restartAutoplay();
        });
    });

    carousel.addEventListener('mouseenter', stopAutoplay);
    carousel.addEventListener('mouseleave', restartAutoplay);

    carousel.addEventListener('touchstart', (event) => {
        if (!event.touches || event.touches.length !== 1) return;
        touchStartX = event.touches[0].clientX;
        touchStartY = event.touches[0].clientY;
        isTouchTracking = true;
    }, { passive: true });

    carousel.addEventListener('touchend', (event) => {
        if (!isTouchTracking || !event.changedTouches || event.changedTouches.length === 0) return;
        isTouchTracking = false;

        const deltaX = event.changedTouches[0].clientX - touchStartX;
        const deltaY = event.changedTouches[0].clientY - touchStartY;
        applySwipe(deltaX, deltaY);
    }, { passive: true });

    carousel.addEventListener('mousedown', (event) => {
        mouseStartX = event.clientX;
        mouseStartY = event.clientY;
        isMouseTracking = true;
    });

    window.addEventListener('mouseup', (event) => {
        if (!isMouseTracking) return;
        isMouseTracking = false;

        const deltaX = event.clientX - mouseStartX;
        const deltaY = event.clientY - mouseStartY;
        applySwipe(deltaX, deltaY);
    });

    carousel.addEventListener('mouseleave', () => {
        isMouseTracking = false;
    });

    document.addEventListener('visibilitychange', () => {
        if (document.hidden) {
            stopAutoplay();
        } else {
            restartAutoplay();
        }
    });

    showSlide(0);
    restartAutoplay();
}

function initNavigation() {
    const leftNavItems = document.querySelectorAll('.left-nav-item');
    const compactNavItems = document.querySelectorAll('.compact-nav-item');
    const mobileNavItems = document.querySelectorAll('.mobile-nav-item');
    const pages = document.querySelectorAll('.page');
    const pillButtons = document.querySelectorAll('.pill-btn');
    
    function handleNavigation(e, navItem, allNavItems, otherNavItems = []) {
        e.preventDefault();
        
        const pageId = navItem.getAttribute('data-page') + '-page';
        
        // Update all navigation items
        allNavItems.forEach(item => item.classList.remove('active'));
        otherNavItems.forEach(item => item.classList.remove('active'));
        navItem.classList.add('active');
        
        // Update corresponding item in other navigation if exists
        const pageType = navItem.getAttribute('data-page');
        if (navItem.classList.contains('left-nav-item')) {
            const correspondingCompact = document.querySelector(`.compact-nav-item[data-page="${pageType}"]`);
            if (correspondingCompact) correspondingCompact.classList.add('active');
        } else if (navItem.classList.contains('compact-nav-item')) {
            const correspondingFull = document.querySelector(`.left-nav-item[data-page="${pageType}"]`);
            if (correspondingFull) correspondingFull.classList.add('active');
        }
        
        // Switch pages
        pages.forEach(page => page.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
        
        window.location.hash = pageId.replace('-page', '');
        
        // Remove all page classes from body
        document.body.classList.remove('on-home-page', 'on-ride-page', 'on-profile-page');
        // Add current page class
        document.body.classList.add('on-' + navItem.getAttribute('data-page') + '-page');
        
        if (pageId === 'home-page') {
            if (newPostsAvailable) {
                showNewPostNotification();
            }
        }
    }
    
    // Left sidebar navigation (desktop)
    leftNavItems.forEach(item => {
        item.addEventListener('click', function(e) {
            handleNavigation(e, this, leftNavItems, compactNavItems);
        });
    });
    
    // Compact sidebar navigation (tablet)
    compactNavItems.forEach(item => {
        item.addEventListener('click', function(e) {
            handleNavigation(e, this, compactNavItems, leftNavItems);
        });
    });
    
    // Mobile bottom navigation
    mobileNavItems.forEach(item => {
        item.addEventListener('click', function(e) {
            handleNavigation(e, this, mobileNavItems);
        });
    });
    
    // Pill button navigation (Ventures/Assets/Freelance)
    pillButtons.forEach(btn => {
        btn.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Update active state for all pill buttons
            pillButtons.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            const page = this.getAttribute('data-page');
            
            // Handle Ventures/Assets/Freelance functionality
            console.log(`${page} section selected`);
            
            // Example functionality - you can customize this
            if (page === 'ventures') {
                // Handle ventures functionality
                alert('Ventures section - Coming soon!');
            } else if (page === 'assets') {
                // Handle assets functionality
                alert('Assets section - Coming soon!');
            } else if (page === 'freelance') {
                // Handle freelance functionality
                alert('Freelance section - Coming soon!');
            }
        });
    });
    
    window.addEventListener('hashchange', function() {
        const hash = window.location.hash.replace('#', '') || 'home';
        const pageId = hash + '-page';
        
        // Update left sidebar navigation (desktop)
        leftNavItems.forEach(item => {
            const pageName = item.getAttribute('data-page');
            item.classList.toggle('active', pageName === hash);
        });
        
        // Update compact sidebar navigation (tablet)
        compactNavItems.forEach(item => {
            const pageName = item.getAttribute('data-page');
            item.classList.toggle('active', pageName === hash);
        });
        
        // Update mobile navigation
        mobileNavItems.forEach(item => {
            const pageName = item.getAttribute('data-page');
            item.classList.toggle('active', pageName === hash);
        });
        
        pages.forEach(page => page.classList.remove('active'));
        document.getElementById(pageId)?.classList.add('active');
        
        // Also update body class for hashchange
        document.body.classList.remove('on-home-page', 'on-ride-page', 'on-profile-page');
        document.body.classList.add('on-' + hash + '-page');
        
        
        if (hash === 'home' && newPostsAvailable) {
            showNewPostNotification();
        }
    });
    
    const logoutBtn = document.getElementById('logoutBtn');
    if (logoutBtn) {
        logoutBtn.addEventListener('click', function() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('associate_logged_in');
                localStorage.removeItem('associate_user_id');
                localStorage.removeItem('associate_login_time');
                localStorage.removeItem('last_feedback_date');
                localStorage.removeItem('last_appearance_count');
                
                deletedRequests.clear();
                localStorage.removeItem('deleted_requests');
                
                alert('Logged out successfully');
            }
        });
    }
}


function initPostModal() {
    const closePostBtn = document.getElementById('closePostBtn');
    const postModal = document.getElementById('postModal');
    
    closePostBtn.addEventListener('click', () => {
        postModal.classList.remove('active');
    });
    
    postModal.addEventListener('click', (e) => {
        if (e.target === postModal) {
            postModal.classList.remove('active');
        }
    });
}

// ========== FEED SYSTEM ==========
function initTrafficabujaFeed() {
    // Load liked and saved posts from localStorage
    const savedLikes = localStorage.getItem('liked_posts');
    const savedSaves = localStorage.getItem('saved_posts');
    
    if (savedLikes) {
        likedPosts = new Set(JSON.parse(savedLikes));
    }
    
    if (savedSaves) {
        savedPosts = new Set(JSON.parse(savedSaves));
    }
    
    // Setup pull-to-refresh
    setupPullToRefresh();
    
    // Load initial posts
    loadPosts();
    
    // Setup new post notification
    setupNewPostNotification();
    
    // Setup real-time updates for new posts
    setupFeedRealtime(); // ADD THIS LINE
    
    // Simulate new posts occasionally
    simulateTrafficabujaPosts();
}
        
        async function loadPosts() {
    try {
        console.log('Loading posts from Supabase...');
        
        // Always try to load from Supabase first
        if (supabaseClient) {
            const { data, error } = await supabaseClient
                .from('feed_posts')
                .select('*')
                .order('created_at', { ascending: false });
            
            if (error) {
                console.error('Supabase error loading posts:', error);
                console.log('Falling back to demo posts');
                loadDemoPosts();
                return;
            }
            
            if (data && data.length > 0) {
                console.log(`Loaded ${data.length} posts from Supabase`);
                
                // Convert Supabase data to our format
                posts = data.map(post => {
                    const createdAt = new Date(post.created_at);
                    
                    return {
                        id: post.id,
                        type: post.media_type || 'image',
                        images: post.media_type === 'image' && post.media_urls ? 
                            post.media_urls.map(url => ({ 
                                url, 
                                alt: post.title || 'TrafficAbuja Post' 
                            })) : 
                            [],
                        video: post.media_type === 'video' && post.media_urls && post.media_urls.length > 0 ? {
                            thumbnail: post.media_urls[0],
                            url: post.media_urls[0]
                        } : null,
                        user: {
                            name: post.user_name || 'TrafficAbuja',
                            initials: post.user_initials || 'TA', // All will be 'TA'
                            verified: post.is_verified !== false
                        },
                        time: getTimeAgo(createdAt),
                        likes: post.likes_count || 0,
                        liked: likedPosts.has(post.id),
                        saved: savedPosts.has(post.id),
                        description: post.description || '',
                        tags: extractTags(post.description) // Helper function to extract hashtags
                    };
                });
                
                renderPosts();
                return;
            }
        }
        
        // If no Supabase client or no data, load demo
        console.log('No Supabase posts found, loading demo posts');
        loadDemoPosts();
        
    } catch (error) {
        console.error('Error in loadPosts:', error);
        loadDemoPosts(); // Fallback to demo
    }
}

// Helper function to extract hashtags from description
function extractTags(description) {
    if (!description) return [];
    const hashtags = description.match(/#[\w\u0590-\u05ff]+/g) || [];
    return hashtags.slice(0, 5); // Max 5 tags
}

// Keep your existing demo posts as fallback
function loadDemoPosts() {
    console.log('Loading demo posts...');
    posts = [
        {
            id: 'demo-1',
            type: 'image',
            images: [
                {url: 'https://images.unsplash.com/photo-1551632811-561732d1e306?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=800&q=80', alt: 'New Partnership'},
                {url: 'https://images.unsplash.com/photo-1511795409834-ef04bbd61622?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=800&q=80', alt: 'Partnership Event'}
            ],
            user: {
                name: 'TrafficAbuja',
                initials: 'TA',
                verified: true
            },
            time: '2 hours ago',
            likes: 142,
            liked: likedPosts.has('demo-1'),
            saved: savedPosts.has('demo-1'),
            description: " Exciting News! We're thrilled to announce our new partnership with Abuja Metropolitan Security Services! \n\nThis collaboration will enhance our traffic management capabilities across the city, bringing you better service and improved safety. Together, we're committed to making Abuja's roads safer and more efficient.\n\n#NewPartnership #AbujaTraffic #RoadSafety #Collaboration #TrafficManagement",
            tags: ['#NewPartnership', '#AbujaTraffic', '#RoadSafety', '#Collaboration', '#TrafficManagement']
        },
        {
            id: 'demo-2',
            type: 'image',
            images: [
                {url: 'https://images.unsplash.com/photo-1511578314322-379afb476865?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h-800&q=80', alt: 'VIP Event Success'}
            ],
            user: {
                name: 'TrafficAbuja',
                initials: 'TA',
                verified: true
            },
            time: '1 day ago',
            likes: 256,
            liked: likedPosts.has('demo-2'),
            saved: savedPosts.has('demo-2'),
            description: " Last night's VIP event was a massive success! Our team managed traffic flawlessly for the diplomatic reception at the International Conference Center.\n\nDespite heavy traffic, our coordinated efforts ensured all guests arrived on time and safely. The client praised our professionalism and efficiency.\n\nSpecial shoutout to our dedicated team members who worked tirelessly through the night! \n\n#VIPEvent #SuccessStory #TrafficManagement #Professionalism #AbujaEvents",
            tags: ['#VIPEvent', '#SuccessStory', '#TrafficManagement', '#Professionalism', '#AbujaEvents']
        },
        {
            id: 'demo-3',
            type: 'image',
            images: [
                {url: 'https://images.unsplash.com/photo-1589829545856-d10d557cf95f?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=800&q=80', alt: 'Celebrity Meeting'},
                {url: 'https://images.unsplash.com/photo-1542740348-39501cd6e2b4?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=800&q=80', alt: 'Team Photo'}
            ],
            user: {
                name: 'TrafficAbuja',
                initials: 'TA', // Changed from 'TT'
                verified: true
            },
            time: '2 days ago',
            likes: 321,
            liked: likedPosts.has('demo-3'),
            saved: savedPosts.has('demo-3'),
            description: " Look who we met! Our team had the honor of providing traffic escort for popular Nollywood actor, Ramsey Nouah, during his visit to Abuja!\n\nIt was a pleasure working with such a professional celebrity team. The coordination was seamless, and Mr. Nouah himself complimented our efficient service.\n\nThese are the moments that make our work special! \n\n#CelebrityEncounter #NollywoodStar #TrafficEscort #ProfessionalService #AbujaMoments",
            tags: ['#CelebrityEncounter', '#NollywoodStar', '#TrafficEscort', '#ProfessionalService', '#AbujaMoments']
        },
        {
            id: 'demo-4',
            type: 'video',
            video: {
                thumbnail: 'https://images.unsplash.com/photo-1511795409834-ef04bbd61622?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=800&q=80',
                url: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerJoyrides.mp4'
            },
            user: {
                name: 'TrafficAbuja',
                initials: 'TA',
                verified: true
            },
            time: '3 days ago',
            likes: 189,
            liked: likedPosts.has('demo-4'),
            saved: savedPosts.has('demo-4'),
            description: " Behind the scenes at the surprise proposal event we managed traffic for! Watch how our team coordinated to create a magical moment for the happy couple.\n\nFrom setting up the perfect arrival timing to managing guest parking discreetly, every detail was carefully planned. The result? A flawless proposal that brought tears of joy!\n\nThis is why we love what we do - creating special moments through perfect execution. \n\n#BehindTheScenes #SurpriseProposal #EventManagement #TrafficCoordination #LoveStory",
            tags: ['#BehindTheScenes', '#SurpriseProposal', '#EventManagement', '#TrafficCoordination', '#LoveStory']
        },
        {
            id: 'demo-5',
            type: 'video',
            video: {
                thumbnail: 'https://images.unsplash.com/photo-1542740348-39501cd6e2b4?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=800&q=80',
                url: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerJoyrides.mp4'
            },
            user: {
                name: 'TrafficAbuja',
                initials: 'TA', // Changed from 'TR'
                verified: true
            },
            time: '1 week ago',
            likes: 423,
            liked: likedPosts.has('demo-5'),
            saved: savedPosts.has('demo-5'),
            description: " Client Review: 'Best experience ever!'\n\nHear directly from Mr. Adebayo, the CEO of MegaCorp Nigeria, about his experience with our VIP escort services during the International Business Summit.\n\n'From start to finish, TrafficAbuja provided exceptional service. Their team was professional, punctual, and handled all traffic challenges effortlessly. I arrived at every meeting on time and stress-free. Highly recommended!'\n\nThank you for the kind words, Mr. Adebayo! We're committed to maintaining this standard of excellence. \n\n#ClientReview #Testimonial #VIPService #ProfessionalExcellence #SatisfiedClient",
            tags: ['#ClientReview', '#Testimonial', '#VIPService', '#ProfessionalExcellence', '#SatisfiedClient']
        }
    ];
    
    renderPosts();
}
        
        function renderPosts() {
    console.log('renderPosts called, posts count:', posts.length);
    
    if (posts.length === 0) {
        console.log('No posts, showing empty state');
        postsContainer.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-images"></i>
                <h3>No posts yet</h3>
                <p>Check back later for updates</p>
            </div>
        `;
        return;
    }
    
    console.log('Rendering', posts.length, 'posts');
    postsContainer.innerHTML = posts.map(post => createPostElement(post)).join('');
    
    // Add event listeners to newly rendered posts
    setupPostInteractions();
    console.log('Post interactions setup complete');
}
        
        function formatLikeCount(likes) {
    if (likes >= 1000000) {
        return (likes / 1000000).toFixed(1) + 'M';
    } else if (likes >= 1000) {
        return (likes / 1000).toFixed(1) + 'K';
    }
    return likes.toString();
}

function createPostElement(post) {
    const isLongDescription = post.description.length > 150;
    const truncatedDescription = isLongDescription ? 
        post.description.substring(0, 150) + '...' : 
        post.description;
    
    return `
        <div class="post" data-post-id="${post.id}">
            <div class="post-header">
                <div class="post-avatar">${post.user.initials}</div>
                <div class="post-user-info">
                    <div class="post-username">
                        ${post.user.name}
                        ${post.user.verified ? ' <i class="fas fa-check-circle" style="color: #0095F6; font-size: 12px;"></i>' : ''}
                    </div>
                    <div class="post-time">${post.time}</div>
                </div>
                <div class="post-more">
                    <i class="fas fa-ellipsis-h"></i>
                </div>
            </div>
            
            ${post.type === 'image' ? renderImagePost(post) : renderVideoPost(post)}
            
            <div class="post-actions">
    <div class="action-with-count">
        <button class="post-action like ${post.liked ? 'liked' : ''}" data-post-id="${post.id}">
            <i class="fas fa-heart"></i>
        </button>
        <span class="action-count">${formatLikeCount(post.likes)}</span>
    </div>
    <div class="action-with-count">
        <button class="post-action comment" data-post-id="${post.id}">
            <i class="fas fa-comment"></i>
        </button>
        <span class="action-count">626</span>
    </div>
    <button class="post-action share" data-post-id="${post.id}" style="margin-left: auto;">
        <i class="fas fa-paper-plane" style="transform: rotate(-45deg);"></i>
    </button>
</div>
            
            <div class="post-description">
                <div class="post-text ${isLongDescription ? 'collapsed' : ''}" data-post-id="${post.id}">
                    <strong>${post.user.name}</strong> ${truncatedDescription}
                </div>
                ${isLongDescription ? `
                    <button class="read-more" data-post-id="${post.id}">more</button>
                ` : ''}
                ${post.tags.length > 0 ? `
                    <div class="post-tags">
                        ${post.tags.map(tag => `<a href="#" class="post-tag">${tag}</a>`).join(' ')}
                    </div>
                ` : ''}
            </div>
        </div>
    `;
}
        
        function renderImagePost(post) {
            if (post.images.length === 1) {
                return `
                    <div class="post-media">
                        <img src="${post.images[0].url}" alt="${post.images[0].alt}" class="post-image" loading="lazy">
                    </div>
                `;
            } else {
                return `
                    <div class="post-media carousel-container" data-carousel-id="${post.id}">
                        <div class="carousel-track" style="transform: translateX(0);">
                            ${post.images.map((image, index) => `
                                <div class="carousel-slide" data-slide-index="${index}">
                                    <img src="${image.url}" alt="${image.alt}" class="post-image" loading="lazy">
                                </div>
                            `).join('')}
                        </div>
                        <div class="carousel-nav">
                            <button class="carousel-btn prev" data-carousel-id="${post.id}">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="carousel-btn next" data-carousel-id="${post.id}">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                        <div class="carousel-dots">
                            ${post.images.map((_, index) => `
                                <div class="carousel-dot ${index === 0 ? 'active' : ''}" data-carousel-id="${post.id}" data-dot-index="${index}"></div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
        }
        
        function renderVideoPost(post) {
            return `
                <div class="post-media">
                    <div class="video-container">
                        <img src="${post.video.thumbnail}" alt="Video thumbnail" class="post-image" loading="lazy">
                        <button class="video-play-btn" data-video-id="${post.id}">
                            <i class="fas fa-play"></i>
                        </button>
                    </div>
                </div>
            `;
        }
        
        function setupPostInteractions() {
    // Like buttons
    document.querySelectorAll('.post-action.like').forEach(btn => {
        btn.addEventListener('click', function() {
            const postId = parseInt(this.getAttribute('data-post-id'));
            toggleLike(postId, this);
        });
    });

     // Comment buttons
    document.querySelectorAll('.post-action.comment').forEach(btn => {
        btn.addEventListener('click', function() {
            const postElement = this.closest('.post');
            const postId = postElement.getAttribute('data-post-id');
            const post = posts.find(p => p.id.toString() === postId.toString());
            
            if (post) {
                showCommentSection(post);
            }
        });
    });

        // ADD SHARE BUTTONS HERE:
    // Share buttons
    document.querySelectorAll('.post-action.share').forEach(btn => {
        btn.addEventListener('click', function() {
            const postElement = this.closest('.post');
            const postId = postElement.getAttribute('data-post-id');
            const post = posts.find(p => p.id.toString() === postId.toString());
            
            if (post) {
                generateShareLink(post);
            }
        });
    });
    

    // Read more buttons - REMOVE parseInt()
    document.querySelectorAll('.read-more').forEach(btn => {
        btn.addEventListener('click', function() {
            const postId = this.getAttribute('data-post-id'); // CHANGED
            console.log('Read more clicked for post:', postId);
            showFullPostDescription(postId);
        });
    });
    
    // Carousel navigation
    document.querySelectorAll('.carousel-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const carouselId = this.getAttribute('data-carousel-id');
            const isNext = this.classList.contains('next');
            navigateCarousel(carouselId, isNext);
        });
    });
    
    // Video play buttons
    document.querySelectorAll('.video-play-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const postId = this.getAttribute('data-video-id');
            playVideo(postId);
        });
    });
    
    // More options buttons
    document.querySelectorAll('.post-more').forEach(btn => {
        btn.addEventListener('click', function() {
            const postElement = this.closest('.post');
            const postId = postElement.getAttribute('data-post-id');
            showPostOptions(postId);
        });
    });
}
        
        function toggleLike(postId, button) {
    console.log('Toggle like for post:', postId, 'Type:', typeof postId);
    
    // Handle both string and number IDs
    const post = posts.find(p => {
        return p.id.toString() === postId.toString();
    });
    
    if (!post) {
        console.error('Post not found for ID:', postId);
        return;
    }
    
    if (post.liked) {
        post.liked = false;
        post.likes--;
        likedPosts.delete(postId);
        button.classList.remove('liked');
    } else {
        post.liked = true;
        post.likes++;
        likedPosts.add(postId);
        button.classList.add('liked');
        
        // Add animation
        button.style.transform = 'scale(1.2)';
        setTimeout(() => {
            button.style.transform = 'scale(1)';
        }, 300);
    }
    
    // Update likes count - FIX THIS TOO
    const postElement = button.closest('.post');
    const likesCountElement = postElement.querySelector('.action-count');
    if (likesCountElement) {
        likesCountElement.textContent = formatLikeCount(post.likes);
    }
    
    // Save to localStorage
    localStorage.setItem('liked_posts', JSON.stringify(Array.from(likedPosts)));
}
        
        function toggleSave(postId, button) {
            const post = posts.find(p => p.id === postId);
            if (!post) return;
            
            if (post.saved) {
                post.saved = false;
                savedPosts.delete(postId);
                button.classList.remove('saved');
            } else {
                post.saved = true;
                savedPosts.add(postId);
                button.classList.add('saved');
                
                // Add animation
                button.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    button.style.transform = 'scale(1)';
                }, 300);
            }
            
            // Save to localStorage
            localStorage.setItem('saved_posts', JSON.stringify(Array.from(savedPosts)));
        }
        
        function showFullPostDescription(postId) {
    const post = posts.find(p => p.id === postId);
    if (!post) {
        console.error('Post not found:', postId);
        return;
    }
    
    console.log('Showing full description for post:', postId);
    
    postModalBody.innerHTML = `
        <div class="post-text">
            <strong>${post.user.name}</strong> ${post.description}
        </div>
        ${post.tags.length > 0 ? `
            <div class="post-tags" style="margin-top: 20px;">
                ${post.tags.map(tag => `<a href="#" class="post-tag">${tag}</a>`).join(' ')}
            </div>
        ` : ''}
    `;
    
    postModal.classList.add('active');
}
        
function showCommentSection(post) {
    // Create comment modal
    const commentModal = document.createElement('div');
    commentModal.className = 'comment-modal';
    commentModal.innerHTML = `
        <div class="comment-modal-content">
            <div class="comment-modal-header">
                <h3>Comments</h3>
                <button class="close-comment-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="comment-modal-body">
                <div class="comments-list" id="comments-${post.id}">
                    <div class="comment-loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        Loading comments...
                    </div>
                </div>
                <div class="comment-input-section">
                    <textarea class="comment-input" placeholder="Add a comment..." rows="2"></textarea>
                    <button class="post-comment-btn" data-post-id="${post.id}">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    `;
    
    document.body.appendChild(commentModal);
    
    // Add event listeners
    commentModal.querySelector('.close-comment-btn').addEventListener('click', () => {
        commentModal.remove();
    });
    
    commentModal.addEventListener('click', (e) => {
        if (e.target === commentModal) {
            commentModal.remove();
        }
    });
    
    // Load comments
    loadComments(post.id);
    
    // Focus on input
    setTimeout(() => {
        commentModal.querySelector('.comment-input').focus();
    }, 300);
}


// ADD LOADCOMMENTS FUNCTION HERE:
function loadComments(postId) {
    // For demo - simulate loading comments
    setTimeout(() => {
        const commentsList = document.getElementById(`comments-${postId}`);
        if (commentsList) {
            commentsList.innerHTML = `
                <div class="comment-item">
                    <div class="comment-avatar">AB</div>
                    <div class="comment-content">
                        <div class="comment-author">Ade Boyo</div>
                        <div class="comment-text">Great work TrafficAbuja! </div>
                        <div class="comment-time">2 hours ago</div>
                    </div>
                </div>
                <div class="comment-item">
                    <div class="comment-avatar">CK</div>
                    <div class="comment-content">
                        <div class="comment-author">Chika Kings</div>
                        <div class="comment-text">This is amazing! Keep it up! </div>
                        <div class="comment-time">4 hours ago</div>
                    </div>
                </div>
            `;
        }
    }, 1000);
}

// ADD THE SHARE FUNCTIONS HERE:
function generateShareLink(post) {
    // Use your actual domain
    const postUrl = `https://trafficabuja.online/post/${post.id}`;
    const shareMessage = `Check out this TrafficAbuja post!`;
    
    // Copy to clipboard
    navigator.clipboard.writeText(postUrl).then(() => {
        // Show notification with your branding
        showShareNotification(' Thanks for sharing!');
    }).catch(err => {
        console.error('Failed to copy: ', err);
        alert(`Share TrafficAbuja:\n${postUrl}`);
    });
}

function showShareNotification(message) {
    // Create a temporary toast notification
    const toast = document.createElement('div');
    toast.textContent = message;
    toast.style.cssText = `
        position: fixed;
        bottom: 100px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 12px 24px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        z-index: 9999;
        animation: fadeInOut 2s ease;
    `;
    
    document.body.appendChild(toast);
    
    // Remove after 2 seconds
    setTimeout(() => {
        toast.remove();
    }, 2000);
}
        function navigateCarousel(carouselId, isNext) {
            const carousel = document.querySelector(`[data-carousel-id="${carouselId}"]`);
            if (!carousel) return;
            
            const track = carousel.querySelector('.carousel-track');
            const slides = carousel.querySelectorAll('.carousel-slide');
            const dots = carousel.querySelectorAll('.carousel-dot');
            
            const currentSlide = parseInt(track.style.transform.replace('translateX(', '').replace('%)', '') || '0');
            const slideWidth = 100;
            const totalSlides = slides.length;
            
            let newSlide;
            if (isNext) {
                newSlide = currentSlide - slideWidth;
                if (newSlide < -(slideWidth * (totalSlides - 1))) {
                    newSlide = 0;
                }
            } else {
                newSlide = currentSlide + slideWidth;
                if (newSlide > 0) {
                    newSlide = -(slideWidth * (totalSlides - 1));
                }
            }
            
            const slideIndex = Math.abs(newSlide / slideWidth);
            
            track.style.transform = `translateX(${newSlide}%)`;
            
            dots.forEach((dot, index) => {
                dot.classList.toggle('active', index === slideIndex);
            });
        }
        
        function playVideo(postId) {
            const post = posts.find(p => p.id === postId);
            if (!post || post.type !== 'video') return;
            
            alert(`Video would play: ${post.video.url}\n\nIn a real implementation, this would embed and play the video.`);
        }
        
        function showPostOptions(postId) {
            const options = [
                'Copy link',
                'Share to...',
                'Report',
                'Turn on notifications for this post',
                'About this account',
                'Cancel'
            ];
            
            alert(`Post options for post ${postId}:\n\n${options.join('\n')}`);
        }
        
        function setupPullToRefresh() {
            const feedContainer = document.getElementById('feedContainer');
            let touchStartY = 0;
            let touchEndY = 0;
            let isDragging = false;
            
            feedContainer.addEventListener('touchstart', function(e) {
                if (feedContainer.scrollTop === 0 && !isRefreshing) {
                    touchStartY = e.touches[0].clientY;
                    isDragging = true;
                }
            });
            
            feedContainer.addEventListener('touchmove', function(e) {
                if (!isDragging || isRefreshing) return;
                
                touchEndY = e.touches[0].clientY;
                const pullDistance = touchEndY - touchStartY;
                
                if (pullDistance > 0 && feedContainer.scrollTop === 0) {
                    e.preventDefault();
                    
                    const pullPercentage = Math.min(pullDistance / 100, 1);
                    refreshIndicator.style.opacity = pullPercentage;
                    refreshIndicator.style.transform = `translateY(${Math.min(pullDistance, 100)}px)`;
                    
                    if (pullDistance > 80 && !refreshIndicator.classList.contains('active')) {
                        refreshIndicator.classList.add('active');
                        refreshIndicator.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Release to refresh';
                    } else if (pullDistance <= 80 && refreshIndicator.classList.contains('active')) {
                        refreshIndicator.classList.remove('active');
                        refreshIndicator.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Pull to refresh';
                    }
                }
            });
            
            feedContainer.addEventListener('touchend', function(e) {
                if (!isDragging || isRefreshing) return;
                
                isDragging = false;
                const pullDistance = touchEndY - touchStartY;
                
                if (pullDistance > 80 && feedContainer.scrollTop === 0) {
                    triggerRefresh();
                } else {
                    refreshIndicator.style.opacity = '0';
                    refreshIndicator.style.transform = 'translateY(-100%)';
                    refreshIndicator.classList.remove('active');
                }
            });
            
            // Mouse support for desktop
            feedContainer.addEventListener('mousedown', function(e) {
                if (feedContainer.scrollTop === 0 && !isRefreshing) {
                    touchStartY = e.clientY;
                    isDragging = true;
                }
            });
            
            feedContainer.addEventListener('mousemove', function(e) {
                if (!isDragging || isRefreshing) return;
                
                touchEndY = e.clientY;
                const pullDistance = touchEndY - touchStartY;
                
                if (pullDistance > 0 && feedContainer.scrollTop === 0) {
                    const pullPercentage = Math.min(pullDistance / 100, 1);
                    refreshIndicator.style.opacity = pullPercentage;
                    refreshIndicator.style.transform = `translateY(${Math.min(pullDistance, 100)}px)`;
                    
                    if (pullDistance > 80 && !refreshIndicator.classList.contains('active')) {
                        refreshIndicator.classList.add('active');
                        refreshIndicator.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Release to refresh';
                    } else if (pullDistance <= 80 && refreshIndicator.classList.contains('active')) {
                        refreshIndicator.classList.remove('active');
                        refreshIndicator.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Pull to refresh';
                    }
                }
            });
            
            feedContainer.addEventListener('mouseup', function(e) {
                if (!isDragging || isRefreshing) return;
                
                isDragging = false;
                const pullDistance = touchEndY - touchStartY;
                
                if (pullDistance > 80 && feedContainer.scrollTop === 0) {
                    triggerRefresh();
                } else {
                    refreshIndicator.style.opacity = '0';
                    refreshIndicator.style.transform = 'translateY(-100%)';
                    refreshIndicator.classList.remove('active');
                }
            });
            
            feedContainer.addEventListener('mouseleave', function(e) {
                if (isDragging) {
                    isDragging = false;
                    refreshIndicator.style.opacity = '0';
                    refreshIndicator.style.transform = 'translateY(-100%)';
                    refreshIndicator.classList.remove('active');
                }
            });
        }
        
        function triggerRefresh() {
            if (isRefreshing) return;
            
            isRefreshing = true;
            refreshIndicator.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Refreshing...';
            refreshIndicator.style.transform = 'translateY(0)';
            
            // Simulate API call delay
            setTimeout(() => {
                // Check for new posts
                const newPostCount = Math.floor(Math.random() * 3); // 0-2 new posts
                
                if (newPostCount > 0) {
                    addNewPosts(newPostCount);
                    newPostsAvailable = true;
                    
                    if (document.querySelector('#home-page').classList.contains('active')) {
                        showNewPostNotification();
                    }
                }
                
                // Update times
                updatePostTimes();
                
                // Complete refresh
                setTimeout(() => {
                    refreshIndicator.innerHTML = '<i class="fas fa-check"></i> Refreshed!';
                    refreshIndicator.style.opacity = '0';
                    refreshIndicator.style.transform = 'translateY(-100%)';
                    
                    setTimeout(() => {
                        isRefreshing = false;
                        refreshIndicator.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Pull to refresh';
                        refreshIndicator.classList.remove('active');
                    }, 1000);
                }, 500);
            }, 1500);
        }
        
        function addNewPosts(count) {
            const newPosts = [];
            const lastId = posts.length > 0 ? posts[0].id : 0;
            
            for (let i = 1; i <= count; i++) {
                const newId = lastId + i;
                newPosts.unshift({
                    id: newId,
                    type: 'image',
                    images: [
                        {url: `https://images.unsplash.com/photo-1551632811-561732d1e306?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=800&q=80&${newId}`, alt: 'New Content'}
                    ],
                    user: {
                        name: 'TrafficAbuja',
                        initials: 'TA',
                        verified: true
                    },
                    time: 'Just now',
                    likes: 0,
                    liked: false,
                    saved: false,
                    description: ` New Update! Fresh content just added to our feed. Stay tuned for more exciting news and updates from the TrafficAbuja team!\n\nWe're constantly working to bring you the latest in traffic management and community updates. #NewContent #Update #TrafficAbuja`,
                    tags: ['#NewContent', '#Update', '#TrafficAbuja']
                });
            }
            
            // Add new posts to the beginning
            posts.unshift(...newPosts);
            
            // Re-render posts
            renderPosts();
        }
        
        function updatePostTimes() {
            // Update times for existing posts
            posts.forEach(post => {
                if (post.time === 'Just now') {
                    post.time = '1 minute ago';
                } else if (post.time === '1 minute ago') {
                    post.time = '2 minutes ago';
                } else if (post.time === '2 minutes ago') {
                    post.time = '5 minutes ago';
                } else if (post.time === '5 minutes ago') {
                    post.time = '10 minutes ago';
                }
                // Other times remain as they are
            });
            
            // Update the display
            document.querySelectorAll('.post').forEach(postElement => {
                const postId = parseInt(postElement.getAttribute('data-post-id'));
                const post = posts.find(p => p.id === postId);
                if (post) {
                    const timeElement = postElement.querySelector('.post-time');
                    if (timeElement) {
                        timeElement.textContent = post.time;
                    }
                }
            });
        }
        
        function setupNewPostNotification() {
            newPostNotification.addEventListener('click', function() {
                hideNewPostNotification();
                
                // Scroll to top and show new posts
                document.getElementById('feedContainer').scrollTop = 0;
                
                // Highlight new posts
                document.querySelectorAll('.post').forEach((postElement, index) => {
                    if (index < 2) { // First 2 posts are new
                        postElement.style.boxShadow = '0 0 0 2px #0095F6';
                        setTimeout(() => {
                            postElement.style.boxShadow = '';
                        }, 2000);
                    }
                });
            });
        }
        
        function showNewPostNotification() {
            if (newPostsAvailable) {
                newPostNotification.classList.add('show');
                
                // Auto-hide after 10 seconds
                setTimeout(() => {
                    hideNewPostNotification();
                }, 10000);
            }
        }
        
        function hideNewPostNotification() {
            newPostNotification.classList.remove('show');
            newPostsAvailable = false;
        }
        
        function simulateTrafficabujaPosts() {
    // Simulate new posts every 2-5 minutes
    setInterval(() => {
        if (Math.random() > 0.7) { // 30% chance
            addNewPosts(1);
            newPostsAvailable = true;
            
            if (document.querySelector('#home-page').classList.contains('active')) {
                showNewPostNotification();
            }
        }
    }, 120000 + Math.random() * 180000); // 2-5 minutes
}

        function setupFeedRealtime() {
    if (!supabaseClient) {
        console.log('Supabase not available for real-time updates');
        return;
    }
    
    try {
        const subscription = supabaseClient
            .channel('feed-posts-channel')
            .on('postgres_changes', 
                {
                    event: 'INSERT',
                    schema: 'public',
                    table: 'feed_posts'
                },
                (payload) => {
                    console.log('New post detected:', payload);
                    
                    // Add notification for new post
                    newPostsAvailable = true;
                    
                    // If user is on home page, show notification
                    if (document.querySelector('#home-page').classList.contains('active')) {
                        showNewPostNotification();
                    }
                    
                    // Reload posts to show the new one
                    loadPosts();
                }
            )
            .subscribe();
            
        console.log('Real-time feed updates enabled');
        
    } catch (error) {
        console.error('Error setting up real-time feed:', error);
    }
}

        // ========== PAGE SWITCHING FUNCTIONS ==========
        function switchToRidePage() {
            console.log('Switching to Ride page');
            
            // Update navigation
            const desktopNavItems = document.querySelectorAll('.desktop-nav-item');
            const mobileNavItems = document.querySelectorAll('.mobile-nav-item');
            const pages = document.querySelectorAll('.page');
            
            // Update desktop nav
            desktopNavItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-page') === 'ride') {
                    item.classList.add('active');
                }
            });
            
            // Update mobile nav
            mobileNavItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-page') === 'ride') {
                    item.classList.add('active');
                }
            });
            
            // Update pages
            pages.forEach(page => {
                page.classList.remove('active');
                if (page.id === 'ride-page') {
                    page.classList.add('active');
                }
            });
            
            // Update URL hash
            window.location.hash = 'ride';
            
            // Update body class
            document.body.classList.remove('on-home-page', 'on-profile-page');
            document.body.classList.add('on-ride-page');
        }
        // ========== LOAD ASSOCIATE DATA ==========
        async function loadAssociateData() {
            try {
                const userLoginId = localStorage.getItem('associate_user_id');
                
                let associateData = null;
                
                if (supabaseClient && userLoginId) {
                    try {
                        const { data, error } = await supabaseClient
                            .from('associates')
                            .select('*')
                            .eq('user_id', userLoginId)
                            .maybeSingle();
                        
                        if (error) {
                            console.warn('Supabase error:', error.message);
                            associateData = getDemoData(userLoginId);
                        } else if (data) {
                            associateData = data;
                        } else {
                            console.warn('No associate found for user_id:', userLoginId);
                            associateData = getDemoData(userLoginId);
                        }
                    } catch (supabaseError) {
                        console.warn('Supabase connection failed:', supabaseError.message);
                        associateData = getDemoData(userLoginId);
                    }
                } else {
                    associateData = getDemoData('demo_user');
                }

                currentAssociate = associateData;
                updateProfileUI(associateData);
                
            } catch (error) {
                console.error('Error in loadAssociateData:', error);
                const demoData = getDemoData('demo_user');
                updateProfileUI(demoData);
            }
        }
        
        function getDemoData(userId) {
    const isRealUser = userId && userId !== 'demo_user';
    
    return {
        name: 'John Doe',
        phone: '+234 800 123 4567',
        address: '123 Main Street, Abuja, Nigeria',
        education: 'Bachelor\'s Degree',
        beneficiaries: JSON.stringify([{ 
            name: 'Jane Smith', 
            phone: '+234 800 987 6543' 
        }]),
        account_details: '0123456789 - Guaranty Trust Bank (GTBank)\nJohn Doe',
        is_verified: true,
        created_at: '2026-01-01T00:00:00Z',
        user_id: userId || 'demo_user',
        id: isRealUser ? userId : 'demo_user' // Use real ID for real users
    };
}
        
        // ========== UPDATE PROFILE UI ==========
        function updateProfileUI(associate) {
            try {
                const firstName = associate.name ? associate.name.split(' ')[0].toUpperCase() : 'USER';
                document.getElementById('userGreeting').textContent = `HI, ${firstName} `;
                
                if (associate.created_at) {
                    const createdDate = new Date(associate.created_at);
                    const formattedDate = createdDate.toLocaleDateString('en-US', {
                        month: 'long',
                        year: 'numeric'
                    });
                    document.getElementById('memberSince').textContent = `Member since: ${formattedDate}`;
                }
                
                document.getElementById('profileName').textContent = associate.name || 'Not set';
                document.getElementById('profilePhone').textContent = associate.phone || 'Not set';
                document.getElementById('profileAddress').textContent = associate.address || 'Not set';
                document.getElementById('profileEducation').textContent = associate.education || 'Not set';
                
                const beneficiaryElement = document.getElementById('profileBeneficiary');
                let beneficiaries = [];
                
                try {
                    if (associate.beneficiaries) {
                        if (typeof associate.beneficiaries === 'string') {
                            beneficiaries = JSON.parse(associate.beneficiaries);
                            if (typeof beneficiaries === 'string') {
                                beneficiaries = JSON.parse(beneficiaries);
                            }
                        } else if (Array.isArray(associate.beneficiaries)) {
                            beneficiaries = associate.beneficiaries;
                        }
                    }
                } catch (e) {
                    console.error("Error parsing beneficiaries:", e);
                }
                
                if (beneficiaryElement) {
                    if (beneficiaries.length === 0) {
                        beneficiaryElement.innerHTML = '<div style="color: #666; padding: 10px;">No beneficiaries set</div>';
                    } else {
                        beneficiaryElement.innerHTML = beneficiaries.map((ben, index) => `
                            <div class="beneficiary-display">
                                <div class="beneficiary-item">
                                    <div class="beneficiary-info">
                                        <h4>${ben.name || 'Not set'}</h4>
                                        <p>${ben.phone || 'Not set'}</p>
                                    </div>
                                    <span class="beneficiary-tag">${index === 0 ? 'Primary' : 'Secondary'}</span>
                                </div>
                            </div>
                        `).join('');
                    }
                }
                
                const accountElement = document.getElementById('profileAccount');
                if (accountElement) {
                    accountElement.textContent = associate.account_details || 'Not provided';
                }
                
            } catch (error) {
                console.error('Error updating profile UI:', error);
                showStatusMessage('Error loading profile data', 'error');
            }
        }

        // ========== SAMPLE ORDERS DATA ==========
        function generateSampleOrders() {
            const orders = [];
            const now = new Date();

            // Generate 15 sample orders
            for (let i = 1; i <= 15; i++) {
                const daysAgo = Math.floor(Math.random() * 60);
                const orderDate = new Date(now.getTime() - daysAgo * 24 * 60 * 60 * 1000);
                
                const statuses = ['settled', 'pending', 'dispute'];
                const status = statuses[Math.floor(Math.random() * statuses.length)];
                
                const orderAmount = Math.floor(Math.random() * 200000) + 20000; // 20k - 220k
                
                orders.push({
                    id: `INV-${String(i).padStart(4, '0')}`,
                    date: orderDate.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }),
                    status: status,
                    totalCost: `${orderAmount.toLocaleString()}`
                });
            }

            return orders.sort((a, b) => new Date(b.date) - new Date(a.date));
        }

        let allOrders = [];
        let currentOrderFilter = 'all';

        // ========== FILTER AND DISPLAY ORDERS ==========
        function filterAndDisplayOrders(filterType = 'all') {
            currentOrderFilter = filterType;
            
            const tableBody = document.getElementById('ordersTableBody');
            const emptyMessage = document.getElementById('emptyOrdersMessage');
            
            let filteredOrders = allOrders;
            
            if (filterType !== 'all') {
                filteredOrders = allOrders.filter(order => order.status === filterType);
            }
            
            if (filteredOrders.length === 0) {
                tableBody.innerHTML = '';
                emptyMessage.style.display = 'flex';
                return;
            }
            
            emptyMessage.style.display = 'none';
            tableBody.innerHTML = filteredOrders.map(order => `
                <tr>
                    <td>${order.id}</td>
                    <td>${order.date}</td>
                    <td>
                        <span class="status-badge ${order.status}">
                            ${order.status.charAt(0).toUpperCase() + order.status.slice(1)}
                        </span>
                    </td>
                    <td>${order.totalCost}</td>
                </tr>
            `).join('');
        }

        // ========== PROFILE NAVIGATION ==========
        function showProfileDetailPage() {
            const profilePage = document.getElementById('profile-page');
            const detailPage = document.getElementById('profile-detail-page');
            
            if (profilePage && detailPage) {
                profilePage.style.display = 'none';
                detailPage.style.display = 'block';
                detailPage.classList.add('active');
                
                // Update the greeting in detail page
                const firstName = currentAssociate?.name ? currentAssociate.name.split(' ')[0].toUpperCase() : 'USER';
                const userGreetingDetail = document.getElementById('userGreetingDetail');
                if (userGreetingDetail) {
                    userGreetingDetail.textContent = `HI, ${firstName} `;
                }
                
                // Scroll to top
                window.scrollTo(0, 0);
            }
        }

        function hideProfileDetailPage() {
            const profilePage = document.getElementById('profile-page');
            const detailPage = document.getElementById('profile-detail-page');
            
            if (profilePage && detailPage) {
                detailPage.style.display = 'none';
                detailPage.classList.remove('active');
                profilePage.style.display = 'block';
                
                // Reset filter to 'all' when returning to main profile
                filterAndDisplayOrders('all');
                
                // Update active filter button
                document.querySelectorAll('.order-filter-btn').forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.getAttribute('data-filter') === 'all') {
                        btn.classList.add('active');
                    }
                });
                
                // Scroll to top
                window.scrollTo(0, 0);
            }
        }

        // ========== INITIALIZE ORDER HISTORY ==========
        function initializeOrderHistory() {
            allOrders = generateSampleOrders();
            filterAndDisplayOrders('all');
            
            // Setup filter buttons
            const filterBtns = document.querySelectorAll('.order-filter-btn');
            filterBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    filterBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    const filterType = this.getAttribute('data-filter');
                    filterAndDisplayOrders(filterType);
                });
            });
            
            // Setup View Profile button
            const viewProfileBtn = document.getElementById('viewProfileBtn');
            if (viewProfileBtn) {
                viewProfileBtn.addEventListener('click', showProfileDetailPage);
            }
            
            // Setup Back button
            const backBtn = document.getElementById('backFromProfileBtn');
            if (backBtn) {
                backBtn.addEventListener('click', hideProfileDetailPage);
            }
        }

// Keep your existing demo posts as fallback
function loadDemoPosts() {
    console.log('Loading demo posts...');
    posts = [
        {
            id: 'demo-1',
            type: 'image',
            images: [
                {url: 'https://images.unsplash.com/photo-1551632811-561732d1e306?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=800&q=80', alt: 'New Partnership'},
                {url: 'https://images.unsplash.com/photo-1511795409834-ef04bbd61622?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=800&q=80', alt: 'Partnership Event'}
            ],
            user: {
                name: 'TrafficAbuja',
                initials: 'TA',
                verified: true
            },
            time: '2 hours ago',
            likes: 142,
            liked: likedPosts.has('demo-1'),
            saved: savedPosts.has('demo-1'),
            description: " Exciting News! We're thrilled to announce our new partnership with Abuja Metropolitan Security Services! \n\nThis collaboration will enhance our traffic management capabilities across the city, bringing you better service and improved safety. Together, we're committed to making Abuja's roads safer and more efficient.\n\n#NewPartnership #AbujaTraffic #RoadSafety #Collaboration #TrafficManagement",
            tags: ['#NewPartnership', '#AbujaTraffic', '#RoadSafety', '#Collaboration', '#TrafficManagement']
        },
        {
            id: 'demo-2',
            type: 'image',
            images: [
                {url: 'https://images.unsplash.com/photo-1511578314322-379afb476865?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h-800&q=80', alt: 'VIP Event Success'}
            ],
            user: {
                name: 'TrafficAbuja',
                initials: 'TA',
                verified: true
            },
            time: '1 day ago',
            likes: 256,
            liked: likedPosts.has('demo-2'),
            saved: savedPosts.has('demo-2'),
            description: " Last night's VIP event was a massive success! Our team managed traffic flawlessly for the diplomatic reception at the International Conference Center.\n\nDespite heavy traffic, our coordinated efforts ensured all guests arrived on time and safely. The client praised our professionalism and efficiency.\n\nSpecial shoutout to our dedicated team members who worked tirelessly through the night! \n\n#VIPEvent #SuccessStory #TrafficManagement #Professionalism #AbujaEvents",
            tags: ['#VIPEvent', '#SuccessStory', '#TrafficManagement', '#Professionalism', '#AbujaEvents']
        },
        {
            id: 'demo-3',
            type: 'image',
            images: [
                {url: 'https://images.unsplash.com/photo-1589829545856-d10d557cf95f?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=800&q=80', alt: 'Celebrity Meeting'},
                {url: 'https://images.unsplash.com/photo-1542740348-39501cd6e2b4?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=800&q=80', alt: 'Team Photo'}
            ],
            user: {
                name: 'TrafficAbuja',
                initials: 'TA', // Changed from 'TT'
                verified: true
            },
            time: '2 days ago',
            likes: 321,
            liked: likedPosts.has('demo-3'),
            saved: savedPosts.has('demo-3'),
            description: " Look who we met! Our team had the honor of providing traffic escort for popular Nollywood actor, Ramsey Nouah, during his visit to Abuja!\n\nIt was a pleasure working with such a professional celebrity team. The coordination was seamless, and Mr. Nouah himself complimented our efficient service.\n\nThese are the moments that make our work special! \n\n#CelebrityEncounter #NollywoodStar #TrafficEscort #ProfessionalService #AbujaMoments",
            tags: ['#CelebrityEncounter', '#NollywoodStar', '#TrafficEscort', '#ProfessionalService', '#AbujaMoments']
        },
        {
            id: 'demo-4',
            type: 'video',
            video: {
                thumbnail: 'https://images.unsplash.com/photo-1511795409834-ef04bbd61622?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=800&q=80',
                url: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerJoyrides.mp4'
            },
            user: {
                name: 'TrafficAbuja',
                initials: 'TA',
                verified: true
            },
            time: '3 days ago',
            likes: 189,
            liked: likedPosts.has('demo-4'),
            saved: savedPosts.has('demo-4'),
            description: " Behind the scenes at the surprise proposal event we managed traffic for! Watch how our team coordinated to create a magical moment for the happy couple.\n\nFrom setting up the perfect arrival timing to managing guest parking discreetly, every detail was carefully planned. The result? A flawless proposal that brought tears of joy!\n\nThis is why we love what we do - creating special moments through perfect execution. \n\n#BehindTheScenes #SurpriseProposal #EventManagement #TrafficCoordination #LoveStory",
            tags: ['#BehindTheScenes', '#SurpriseProposal', '#EventManagement', '#TrafficCoordination', '#LoveStory']
        },
        {
            id: 'demo-5',
            type: 'video',
            video: {
                thumbnail: 'https://images.unsplash.com/photo-1542740348-39501cd6e2b4?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=800&q=80',
                url: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerJoyrides.mp4'
            },
            user: {
                name: 'TrafficAbuja',
                initials: 'TA', // Changed from 'TR'
                verified: true
            },
            time: '1 week ago',
            likes: 423,
            liked: likedPosts.has('demo-5'),
            saved: savedPosts.has('demo-5'),
            description: " Client Review: 'Best experience ever!'\n\nHear directly from Mr. Adebayo, the CEO of MegaCorp Nigeria, about his experience with our VIP escort services during the International Business Summit.\n\n'From start to finish, TrafficAbuja provided exceptional service. Their team was professional, punctual, and handled all traffic challenges effortlessly. I arrived at every meeting on time and stress-free. Highly recommended!'\n\nThank you for the kind words, Mr. Adebayo! We're committed to maintaining this standard of excellence. \n\n#ClientReview #Testimonial #VIPService #ProfessionalExcellence #SatisfiedClient",
            tags: ['#ClientReview', '#Testimonial', '#VIPService', '#ProfessionalExcellence', '#SatisfiedClient']
        }
    ];
    
    renderPosts();
}

// Also keep this call in loadPosts():
console.log('No Supabase posts found, loading demo posts');
loadDemoPosts(); // Fallback to demo

// Keep this function too:
function simulateTrafficabujaPosts() {
    // Simulate new posts every 2-5 minutes
    setInterval(() => {
        if (Math.random() > 0.7) { // 30% chance
            addNewPosts(1);
            newPostsAvailable = true;
            
            if (document.querySelector('#home-page').classList.contains('active')) {
                showNewPostNotification();
            }
        }
    }, 120000 + Math.random() * 180000); // 2-5 minutes
}        
        

        function setupRealTimeUpdates() {
            if (!supabaseClient) return;
            
            try {
                realtimeSubscription = supabaseClient
                    .channel('requests-channel')
                    .on('postgres_changes', {
                        event: '*',
                        schema: 'public',
                        table: 'requests'
                    }, payload => {
                        console.log('Real-time update received:', payload);
                        refreshRequests();
                    })
                    .subscribe();
                
                console.log('Real-time updates enabled');
                
            } catch (error) {
                console.error('Error setting up real-time updates:', error);
            }
        }
                    

            function filterRequestsByDistance(requests, userLoc) {
                return requests.filter(request => {
                    if (!request.latitude || !request.longitude) return false;
                    
                    const distance = calculateDistance(
                        userLoc.lat, userLoc.lng,
                        request.latitude, request.longitude
                    );
                    
                    // Convert distance to walking time (5 km/h average walking speed)
                    const walkingTimeMinutes = (distance / 5) * 60; // 5 km/h
                    
                    // Return requests within 12 minutes walk
                    return walkingTimeMinutes <= 12;
                });
            }
            
            function calculateDistance(lat1, lon1, lat2, lon2) {
                // Haversine formula
                const R = 6371; // Earth's radius in km
                const dLat = toRad(lat2 - lat1);
                const dLon = toRad(lon2 - lon1);
                const a = 
                    Math.sin(dLat/2) * Math.sin(dLat/2) +
                    Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * 
                    Math.sin(dLon/2) * Math.sin(dLon/2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
                const distance = R * c; // Distance in km
                return distance;
            }
            
            function toRad(degrees) {
                return degrees * (Math.PI / 180);
            }
            
            function displayRequest(request, index) {
    console.log('displayRequest called for request:', request.id);
    
    // Check if we have userLocation
    if (!userLocation) {
        console.error('No user location available');
        userLocation = { lat: 9.0765, lng: 7.3986 }; // Default fallback
    }
    
    const walkingTime = Math.round((calculateDistance(
        userLocation.lat, userLocation.lng,
        request.latitude, request.longitude
    ) / 5) * 60);
    
    const message = `
 <strong>Request #${index}</strong>

<b>Service:</b> ${request.service_class || 'Not specified'}
<b>Location:</b> ${request.location || 'Location not specified'}
<b>Walking time:</b> ${walkingTime} minutes
<b>Description:</b> ${request.description || 'No description'}
<b>Contact:</b> ********** (masked for privacy)
<b>Date:</b> ${request.request_date || 'Not specified'}
<b>Time:</b> ${request.request_time || '--:--'}
<b>People needed:</b> ${request.many_count || 1}

    `;
    
    // FIX: Don't pass 'true' - create custom button array
    const acceptButton = {
        text: ' Accept Request', 
        action: 'accept', 
        requestId: request.id, 
        requestData: request 
    };
    
    // Create custom message with Accept button
    const messageElement = document.createElement('div');
    messageElement.className = 'message bot-message';
    messageElement.innerHTML = `
        <div class="message-avatar">
            <i class="fas fa-robot"></i>
        </div>
        <div class="message-content">
            <div class="message-text">${message}</div>
            <div class="message-buttons">
                <button class="menu-option accept-request-btn" 
                        data-request-id="${request.id}" 
                        data-request-data='${JSON.stringify(request)}'>
                     Accept Request
                </button>
            </div>
            <div class="message-time">Just now</div>
        </div>
    `;
    
    const chatMessages = document.getElementById('chatMessages');
    chatMessages.appendChild(messageElement);
    
    // Add event listener to the Accept button
    const acceptBtn = messageElement.querySelector('.accept-request-btn');
    acceptBtn.addEventListener('click', function() {
        const requestId = this.getAttribute('data-request-id');
        const requestData = JSON.parse(this.getAttribute('data-request-data'));
        console.log('Accept button clicked for request:', requestId);
        handleAcceptRequest(requestId, requestData);
    });
    
    scrollToBottom();
}

function getDemoRequests() {
    console.log('getDemoRequests called');
    return [
        {
            id: 'req-1',
            service_class: 'VIP Escort',
            location: 'Central Business District, Abuja',
            description: 'Need traffic control for VIP movement from Airport to City Center',
            latitude: 9.0765,
            longitude: 7.3986,
            request_date: '2024-01-20',
            request_time: '14:00',
            many_count: 3,
            request_code: 'REQ-001'
        },
        {
            id: 'req-2',
            service_class: 'Event Support',
            location: 'Maitama District',
            description: 'Event traffic management for wedding ceremony',
            latitude: 9.0820,
            longitude: 7.3926,
            request_date: '2024-01-21',
            request_time: '10:00',
            many_count: 2,
            request_code: 'REQ-002'
        },
        {
            id: 'req-3',
            service_class: 'Traffic Management',
            location: 'Wuse Market Area',
            description: 'Traffic decongestion during peak hours',
            latitude: 9.0680,
            longitude: 7.4750,
            request_date: '2024-01-19',
            request_time: '17:00',
            many_count: 4,
            request_code: 'REQ-003'
        }
    ];
}

async function handleAcceptRequest(requestId, requestData) {
    console.log('handleAcceptRequest called for:', requestId);
    
    // Prevent duplicate acceptance
    if (window.isRequestAccepting) {
        console.log('Already processing an acceptance');
        return;
    }
    window.isRequestAccepting = true;
    
    addUserMessage(' Accept Request');
    addBotMessage('Processing your acceptance...');
    
    try {
        // Save to Supabase (optional - for record keeping)
        if (supabaseClient && currentAssociate) {
            const { error } = await supabaseClient
                .from('request_acceptances')
                .insert({
                    request_id: requestId,
                    associate_id: currentAssociate.id,
                    associate_user_id: currentAssociate.user_id,
                    group_size: currentFlow === 'group' ? groupSize : 1,
                    user_latitude: userLocation?.lat,
                    user_longitude: userLocation?.lng,
                    request_latitude: requestData.latitude,
                    request_longitude: requestData.longitude,
                    accepted_at: new Date().toISOString(),
                    status: 'pending_approval'
                });
                
            if (error) {
                console.error('Error saving acceptance:', error);
            } else {
                console.log('Acceptance saved to Supabase');
            }
        }
        
        // Generate Google Maps link (for future admin use)
        const mapsLink = `https://www.google.com/maps/dir/?api=1&destination=${requestData.latitude},${requestData.longitude}`;
        
        // For testing: Log what would go to admin
        console.log('=== REQUEST ACCEPTED (Admin would receive) ===');
        console.log('Associate:', currentAssociate?.name);
        console.log('Request:', requestData.service_class);
        console.log('Associate Location:', userLocation);
        console.log('Request Location:', { lat: requestData.latitude, lng: requestData.longitude });
        console.log('Maps Link:', mapsLink);
        console.log('Group Size:', currentFlow === 'group' ? groupSize : 1);
        
        // Show success in chat
        setTimeout(() => {
            addBotMessage(' Request accepted.');
            
            setTimeout(() => {
                // Switch to Ride page
                switchToRidePage();
                
                // Reset accepting flag
                setTimeout(() => {
                    window.isRequestAccepting = false;
                }, 1000);
                
            }, 1000);
            
        }, 1500);
        
    } catch (error) {
        console.error('Error in handleAcceptRequest:', error);
        addBotMessage(' Error accepting request. Please try again.');
        window.isRequestAccepting = false;
    }
}

            

        // ========== RESPONSIVE BEHAVIOR ==========
        function updateNavigationState() {
            const currentPage = document.querySelector('.page.active').id.replace('-page', '');
            const desktopNavItems = document.querySelectorAll('.desktop-nav-item');
            const mobileNavItems = document.querySelectorAll('.mobile-nav-item');
            
            if (window.innerWidth >= 769) {
                desktopNavItems.forEach(item => {
                    const pageName = item.getAttribute('data-page');
                    item.classList.toggle('active', pageName === currentPage);
                });
            } else {
                mobileNavItems.forEach(item => {
                    const pageName = item.getAttribute('data-page');
                    item.classList.toggle('active', pageName === currentPage);
                });
            }
        }
        
        function updateViewportHeight() {
            const navHeight = document.querySelector('.bottom-nav').offsetHeight;
            const mainContent = document.querySelector('.main-content');
            
            if (window.innerWidth <= 768) {
                const contentHeight = window.innerHeight - navHeight;
                mainContent.style.height = `${contentHeight}px`;
            } else {
                mainContent.style.height = 'auto';
            }
        }
        
        window.addEventListener('resize', function() {
            updateViewportHeight();
            updateNavigationState();
        });
        
        window.addEventListener('orientationchange', function() {
            setTimeout(() => {
                updateViewportHeight();
                updateNavigationState();
            }, 150);
        });
        
        updateNavigationState();
        updateViewportHeight();
        
        if (!window.location.hash) {
            window.location.hash = 'home';
        }

        // ========== SHOP FUNCTIONALITY (Home Page Only) ==========
        function initShop() {
            const shopPanel = document.getElementById('shopPanel');
            const feedPanel = document.getElementById('feedPanel');
            const homePage = document.getElementById('home-page');
            let lastTapTime = 0;
            let doubleTapDetected = false;

            // ===== PANEL SWITCHING =====
            function setActivePanel(active) {
                shopPanel.classList.remove('active');
                feedPanel.classList.remove('active');

                if (active === 'shop') {
                    shopPanel.classList.add('active');
                } else {
                    feedPanel.classList.add('active');
                }
            }

            // ===== DOUBLE-TAP GESTURE HANDLER =====
            function togglePanel() {
                const isShopActive = shopPanel.classList.contains('active');
                const nextPanel = isShopActive ? 'feed' : 'shop';
                showLoadingState();
                setTimeout(() => {
                    setActivePanel(nextPanel);
                    hideLoadingState();
                }, 800);
            }

            function showLoadingState() {
                const overlay = document.createElement('div');
                overlay.className = 'loading-overlay';
                overlay.id = 'loadingOverlay';
                overlay.innerHTML = '<div class="loading-spinner"></div>';
                document.body.appendChild(overlay);
            }

            function hideLoadingState() {
                const overlay = document.getElementById('loadingOverlay');
                if (overlay) {
                    overlay.classList.add('hide');
                    setTimeout(() => overlay.remove(), 300);
                }
            }

            function showFirstTimeToast() {
                const hasSeenToast = localStorage.getItem('doubleTapToastSeen');
                if (!hasSeenToast) {
                    const toast = document.createElement('div');
                    toast.className = 'double-tap-toast';
                    toast.textContent = 'Double-tap to switch between panels';
                    document.body.appendChild(toast);
                    localStorage.setItem('doubleTapToastSeen', 'true');
                    setTimeout(() => toast.remove(), 3000);
                }
            }

            // Touch event for mobile double-tap detection
            homePage.addEventListener('touchstart', (e) => {
                const currentTime = new Date().getTime();
                const tapLength = currentTime - lastTapTime;

                if (tapLength < 300 && tapLength > 0) {
                    e.preventDefault();
                    if (!doubleTapDetected) {
                        doubleTapDetected = true;
                        togglePanel();
                        setTimeout(() => { doubleTapDetected = false; }, 300);
                    }
                } else {
                    lastTapTime = currentTime;
                }
            });

            // Double-click event for desktop users
            homePage.addEventListener('dblclick', (e) => {
                e.preventDefault();
                togglePanel();
            });

            // Show toast on first visit
            showFirstTimeToast();

            // ---------- category data (Abuja locations) ----------
            const categories = [
                { id: 'maitama', label: 'Maitama', count: 3, bg: 'https://images.unsplash.com/photo-1524661567088-c4b5bd40bfc7?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=600&q=80' },
                { id: 'asokoro', label: 'Asokoro', count: 2, bg: 'https://images.unsplash.com/photo-1449844908441-8829872d2607?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=600&q=80' },
                { id: 'gwarinpa', label: 'Gwarinpa', count: 4, bg: 'https://images.unsplash.com/photo-1493693398161-369417601cbc?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=600&q=80' },
                { id: 'wuse', label: 'Wuse II', count: 5, bg: 'https://images.unsplash.com/photo-1480714378408-67cf0d13bc1b?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=600&q=80' },
                { id: 'jabi', label: 'Jabi', count: 2, bg: 'https://images.unsplash.com/photo-1449844908441-8829872d2607?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=600&q=80' }
            ];

            // event pool
            const eventPool = {
                maitama: [
                    { id: 1, label: 'maitama', title: 'Private High-Jewelry Showcase  Maison Collection', venue: 'The Penthouse, Crown Towers  Maitama', price: '$450 + $0.45', indulgence: '1,500,000', transport: 'Mercedes S-Class pickup + Air transport', desc: 'standby driver & pilot / multi-stop', guests: 80, invite: 14, reactions: 214 },
                    { id: 2, label: 'maitama', title: 'Rare Collectors\' Evening  Heritage Timepieces', venue: 'The Observatory, Maitama', price: '$950 + $0.65', indulgence: '3,200,000', transport: 'Bentley chauffeured + seaplane', desc: 'private driver & pilot', guests: 50, invite: 8, reactions: 89 },
                    { id: 3, label: 'maitama', title: 'Exclusive VIP Gala Night', venue: 'InterContinental Hotel  Maitama', price: '$1,200 + $0.80', indulgence: '2,800,000', transport: 'Maybach + driver service', desc: 'concierge & valet', guests: 60, invite: 12, reactions: 167 }
                ],
                asokoro: [
                    { id: 4, label: 'asokoro', title: 'Diplomatic Reception Evening', venue: 'Presidential Estate, Asokoro', price: '$850 + $0.50', indulgence: '2,200,000', transport: 'Rolls-Royce + security escort', desc: 'protocol officer', guests: 40, invite: 8, reactions: 145 },
                    { id: 5, label: 'asokoro', title: 'Luxury Wellness Retreat', venue: 'Spa & Resort, Asokoro', price: '$600 + $0.35', indulgence: '1,800,000', transport: 'Premium sedan', desc: 'wellness coordinator', guests: 25, invite: 6, reactions: 98 }
                ],
                gwarinpa: [
                    { id: 6, label: 'gwarinpa', title: 'Tech & Innovation Summit', venue: 'Convention Center  Gwarinpa', price: '$500 + $0.40', indulgence: '1,600,000', transport: 'Mercedes E-Class service', desc: 'event coordinator', guests: 100, invite: 18, reactions: 256 },
                    { id: 7, label: 'gwarinpa', title: 'Networking Excellence Forum', venue: 'Business Hub, Gwarinpa', price: '$450 + $0.38', indulgence: '1,400,000', transport: 'Premium transport', desc: 'host & guide', guests: 75, invite: 15, reactions: 189 },
                    { id: 8, label: 'gwarinpa', title: 'Startup Showcase Evening', venue: 'Innovation Center  Gwarinpa', price: '$400 + $0.30', indulgence: '1,200,000', transport: 'Sedan transport', desc: 'logistics support', guests: 80, invite: 16, reactions: 212 },
                    { id: 9, label: 'gwarinpa', title: 'Leadership Conference', venue: 'Corporate Center, Gwarinpa', price: '$700 + $0.55', indulgence: '2,100,000', transport: 'Executive transport', desc: 'session coordinator', guests: 90, invite: 20, reactions: 298 }
                ],
                wuse: [
                    { id: 10, label: 'wuse', title: 'Fashion Week Gala', venue: 'Exhibition Center  Wuse II', price: '$800 + $0.60', indulgence: '2,400,000', transport: 'Luxury sedan + styling', desc: 'fashion coordinator', guests: 120, invite: 25, reactions: 342 },
                    { id: 11, label: 'wuse', title: 'Art & Culture Celebration', venue: 'National Museum, Wuse II', price: '$550 + $0.42', indulgence: '1,700,000', transport: 'Premium transport', desc: 'cultural guide', guests: 65, invite: 12, reactions: 201 },
                    { id: 12, label: 'wuse', title: 'Culinary Excellence Event', venue: 'Fine Dining Hall  Wuse II', price: '$900 + $0.70', indulgence: '2,700,000', transport: 'Bentley service', desc: 'culinary guide', guests: 50, invite: 10, reactions: 278 },
                    { id: 13, label: 'wuse', title: 'Music & Entertainment Show', venue: 'Concert Hall, Wuse II', price: '$650 + $0.50', indulgence: '2,000,000', transport: 'VIP transport', desc: 'entertainment coord', guests: 150, invite: 30, reactions: 425 },
                    { id: 14, label: 'wuse', title: 'Business Networking Dinner', venue: 'Hotel Ballroom  Wuse II', price: '$500 + $0.40', indulgence: '1,500,000', transport: 'Corporate sedan', desc: 'host service', guests: 80, invite: 16, reactions: 234 }
                ],
                jabi: [
                    { id: 15, label: 'jabi', title: 'Waterfront Recreation Fest', venue: 'Jabi Lake Resort', price: '$400 + $0.35', indulgence: '1,300,000', transport: 'Premium sport utility', desc: 'activity coordinator', guests: 100, invite: 20, reactions: 267 },
                    { id: 16, label: 'jabi', title: 'Outdoor Adventure Experience', venue: 'Adventure Park, Jabi', price: '$450 + $0.38', indulgence: '1,450,000', transport: 'Adventure vehicle', desc: 'guide & safety officer', guests: 75, invite: 15, reactions: 189 }
                ]
            };

            // Ensure every event carries a pets policy flag for UI display.
            Object.values(eventPool).forEach((list) => {
                list.forEach((eventItem) => {
                    if (typeof eventItem.petsAllowed !== 'boolean') {
                        eventItem.petsAllowed = eventItem.id % 2 !== 0;
                    }
                });
            });

            // render category carousel (location-based tiles)
            const carousel = document.getElementById('categoryCarousel');
            categories.forEach((cat, index) => {
                const item = document.createElement('div');
                item.className = `category-item ${index === 0 ? 'active' : ''}`;
                item.dataset.category = cat.id;
                item.innerHTML = `
                    <div class="location-card-container">
                        <div class="category-circle" style="background-image: linear-gradient(180deg, transparent 0%, rgba(0,0,0,0.15) 100%), url('${cat.bg}'); background-size: cover; background-position: center;">
                            <div class="map-pin-icon"><i class="fas fa-location-dot"></i></div>
                            <div class="circle-ring-outline"></div>
                        </div>
                        <div class="location-info">
                            <span class="category-label">${cat.label}</span>
                            <div class="divider-line"></div>
                            <span class="category-count">${cat.count} events</span>
                        </div>
                    </div>
                `;
                carousel.appendChild(item);
            });

            let selectedCategoryId = 'maitama';
            let recommendedSortMode = 'recommended';
            let timeSortMode = 'anytime';

            function parseBasePrice(priceText) {
                const match = String(priceText || '').match(/\$([\d,]+(?:\.\d+)?)/);
                return match ? parseFloat(match[1].replace(/,/g, '')) : Number.MAX_SAFE_INTEGER;
            }

            function getEventAgeHours(eventItem) {
                return ((Number(eventItem.id) * 11) % 190) + 1;
            }

            function closeSortDropdowns(root = document) {
                root.querySelectorAll('.sort-dropdown-menu.show').forEach(menu => {
                    menu.classList.remove('show');
                });
            }

            function buildSortBarHtml() {
                return `
                    <div class="category-sort-bar">
                        <span class="category-sort-label">Sort by:</span>

                        <div class="sort-control">
                            <button type="button" class="sort-trigger" data-sort-trigger="recommended">
                                <i class="fas fa-arrow-down-short-wide"></i>
                                <span>Recommended</span>
                            </button>
                            <div class="sort-dropdown-menu" data-sort-menu="recommended">
                                <button type="button" class="sort-option ${recommendedSortMode === 'lowest' ? 'active' : ''}" data-recommended-sort="lowest">Lowest price first</button>
                                <button type="button" class="sort-option ${recommendedSortMode === 'highest' ? 'active' : ''}" data-recommended-sort="highest">Highest price first</button>
                            </div>
                        </div>

                        <span class="sort-divider">|</span>

                        <div class="sort-control">
                            <button type="button" class="sort-trigger" data-sort-trigger="anytime">
                                <i class="fas fa-clock"></i>
                                <span>Any time</span>
                            </button>
                            <div class="sort-dropdown-menu" data-sort-menu="anytime">
                                <button type="button" class="sort-option ${timeSortMode === '24h' ? 'active' : ''}" data-time-sort="24h">Last hour to 24 Hours</button>
                                <button type="button" class="sort-option ${timeSortMode === '7d' ? 'active' : ''}" data-time-sort="7d">Last hour to 7 Days</button>
                            </div>
                        </div>
                    </div>
                `;
            }

            function attachSortHandlers(container) {
                container.querySelectorAll('[data-sort-trigger]').forEach(trigger => {
                    trigger.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const menuType = this.getAttribute('data-sort-trigger');
                        const menu = container.querySelector(`[data-sort-menu="${menuType}"]`);
                        if (!menu) return;

                        const shouldOpen = !menu.classList.contains('show');
                        closeSortDropdowns(container);
                        if (shouldOpen) {
                            menu.classList.add('show');
                        }
                    });
                });

                container.querySelectorAll('[data-recommended-sort]').forEach(option => {
                    option.addEventListener('click', function(e) {
                        e.stopPropagation();
                        recommendedSortMode = this.getAttribute('data-recommended-sort');
                        closeSortDropdowns();
                        renderCategoryEvents(selectedCategoryId);
                    });
                });

                container.querySelectorAll('[data-time-sort]').forEach(option => {
                    option.addEventListener('click', function(e) {
                        e.stopPropagation();
                        timeSortMode = this.getAttribute('data-time-sort');
                        closeSortDropdowns();
                        renderCategoryEvents(selectedCategoryId);
                    });
                });
            }

            document.addEventListener('click', () => closeSortDropdowns());

            // render events for a category (with reaction row)
            function renderCategoryEvents(categoryId) {
                selectedCategoryId = categoryId;
                const container = document.getElementById('categoryContent');
                const events = [...(eventPool[categoryId] || [])];
                const category = categories.find(c => c.id === categoryId);

                if (timeSortMode === '24h') {
                    for (let i = events.length - 1; i >= 0; i--) {
                        if (getEventAgeHours(events[i]) > 24) {
                            events.splice(i, 1);
                        }
                    }
                } else if (timeSortMode === '7d') {
                    for (let i = events.length - 1; i >= 0; i--) {
                        if (getEventAgeHours(events[i]) > 168) {
                            events.splice(i, 1);
                        }
                    }
                }

                if (recommendedSortMode === 'lowest') {
                    events.sort((a, b) => parseBasePrice(a.price) - parseBasePrice(b.price));
                } else if (recommendedSortMode === 'highest') {
                    events.sort((a, b) => parseBasePrice(b.price) - parseBasePrice(a.price));
                }

                let html = buildSortBarHtml();

                if (events.length === 0) {
                    html += `<p style="text-align:center; color:#7c8b9a; padding:40px;">No events in this range</p>`;
                    container.innerHTML = html;
                    attachSortHandlers(container);
                    return;
                }

                events.forEach(ev => {
                    html += `
                        <div class="post-card" data-event-id="${ev.id}">
                            <div class="card-image" style="background-image: linear-gradient(0deg, rgba(0,0,0,0.2), rgba(0,0,0,0.25)), url('${category.bg}');">
                                <div class="watermark-brand">
                                    <div class="watermark-icon">TA</div>
                                    <div class="watermark-handle">
                                        <span>TrafficAbuja</span>
                                        <i class="fas fa-check-circle verified-badge-water"></i>
                                    </div>
                                </div>
                                <span class="image-label">${ev.label}  exclusive</span>
                            </div>
                            <div class="card-content">
                                <div class="datetime-row">
                                    <span class="date-muted"><i class="far fa-calendar-alt"></i> 6 Sep, 610pm</span>
                                    <span class="urgent-badge">${ev.invite} Invite</span>
                                </div>
                                <div class="event-title">${ev.title}</div>
                                <div class="venue-row"><i class="fas fa-map-pin"></i> ${ev.venue}</div>
                                <div class="info-inline">
                                    <span><i class="far fa-user"></i> ${ev.guests} guests only</span>
                                    <span><i class="fas fa-tag"></i> ${ev.price}</span>
                                    <span class="pet-policy"><i class="fas fa-paw"></i> ${ev.petsAllowed ? 'Pets allowed' : 'Pets not allowed'}</span>
                                    <span class="optional-indulgence"><i class="fas fa-coins"></i> Opt. Indulgence ${ev.indulgence}</span>
                                </div>
                                <div class="transport-block">
                                    <div class="transport-title"><i class="fas fa-car-side"></i> ${ev.transport}</div>
                                    <div class="close-x"></div>
                                    <div class="transport-desc"><i class="fas fa-user-tie"></i> ${ev.desc}</div>
                                </div>
                                <div class="add-to-order-ribbon">
                                    <span></i>Get in touch</span>
                                    <span class="guest-limit">2/Guests</span>
                                </div>
                            </div>
                        </div>
                    `;
                });
                container.innerHTML = html;
                attachSortHandlers(container);
            }

            // initial render (maitama)
            renderCategoryEvents('maitama');

            // category click handling
            document.querySelectorAll('.category-item').forEach(item => {
                item.addEventListener('click', function() {
                    document.querySelectorAll('.category-item').forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                    const catId = this.dataset.category;
                    renderCategoryEvents(catId);
                });
            });

            setActivePanel('shop'); // Start with shop panel visible
        }

        // Initialize shop on home page only
        if (document.getElementById('home-page')) {
            initShop();
        }

        // ========== MAP PAGE INITIALIZATION ==========
        function initMapPage() {
            const viewAllLink = document.querySelector('.nearby-setting-link');
            const backBtn = document.getElementById('backFromMapBtn');
            const mapPage = document.getElementById('map-page');
            const homePage = document.getElementById('home-page');
            const mapContainer = document.getElementById('map-container');
            const locationSearch = document.getElementById('locationSearch');
            const geolocateBtn = document.getElementById('geolocateBtn');
            const radiusSlider = document.getElementById('radiusSlider');
            const nearbyPreferenceCard = document.getElementById('nearbyPreferenceCard');
            
            const defaultLocation = { lat: 9.0765, lng: 7.3986 };
            let map = null;
            let userMarker = null;
            let radiusCircle = null;
            let currentLocation = { ...defaultLocation };

            function initializeInlinePreferenceEditing() {
                if (!nearbyPreferenceCard) return;

                nearbyPreferenceCard.addEventListener('click', (event) => {
                    const editBtn = event.target.closest('.nearby-pref-edit-btn');
                    if (!editBtn) return;

                    event.preventDefault();
                    event.stopPropagation();

                    const chip = editBtn.closest('.nearby-pref-chip');
                    if (!chip || chip.classList.contains('editing')) return;

                    const label = chip.querySelector('.nearby-pref-chip-text');
                    if (!label) return;

                    const originalText = label.textContent.trim();
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.className = 'nearby-pref-chip-input';
                    input.value = originalText;
                    input.setAttribute('aria-label', 'Edit preference');
                    input.size = Math.max(originalText.length, 8);

                    label.replaceWith(input);
                    chip.classList.add('editing');

                    let hasCommitted = false;
                    const commit = (saveChanges) => {
                        if (hasCommitted) return;
                        hasCommitted = true;

                        const nextText = saveChanges ? input.value.trim() : originalText;
                        const replacement = document.createElement('span');
                        replacement.className = 'nearby-pref-chip-text';
                        replacement.textContent = nextText || originalText;
                        input.replaceWith(replacement);
                        chip.classList.remove('editing');
                    };

                    input.addEventListener('input', () => {
                        input.size = Math.max(input.value.length, 8);
                    });

                    input.addEventListener('keydown', (keyEvent) => {
                        if (keyEvent.key === 'Enter') {
                            keyEvent.preventDefault();
                            commit(true);
                        } else if (keyEvent.key === 'Escape') {
                            keyEvent.preventDefault();
                            commit(false);
                        }
                    });

                    input.addEventListener('blur', () => commit(true), { once: true });
                    input.focus();
                    input.select();
                });
            }

            initializeInlinePreferenceEditing();

            function getRadiusKm() {
                const value = parseFloat(radiusSlider?.value ?? '1');
                return Number.isFinite(value) ? value : 1;
            }

            function updateSliderGradient() {
                if (!radiusSlider) return;
                const percentage = ((radiusSlider.value - radiusSlider.min) / (radiusSlider.max - radiusSlider.min)) * 100;
                radiusSlider.style.setProperty('--percentage', `${percentage}%`);
            }

            function updateRadiusCircle() {
                if (!radiusCircle) return;
                radiusCircle.setLatLng([currentLocation.lat, currentLocation.lng]);
                radiusCircle.setRadius(getRadiusKm() * 1000);
            }

            function setLocation(lat, lng, zoom) {
                currentLocation = { lat, lng };
                if (typeof zoom === 'number' && map) {
                    map.setView([lat, lng], zoom);
                }
                if (userMarker) {
                    userMarker.setLatLng([lat, lng]);
                }
                updateRadiusCircle();
            }

            // Handle View All click
            if (viewAllLink) {
                viewAllLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    homePage.classList.remove('active');
                    mapPage.classList.add('active');
                    initializeMap();
                });
            }

            // Handle Back click
            if (backBtn) {
                backBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    mapPage.classList.remove('active');
                    homePage.classList.add('active');
                });
            }

            // Initialize Leaflet map
            function initializeMap() {
                if (map) return; // Map already initialized

                // Check if Leaflet is available
                if (typeof L === 'undefined') {
                    console.error('Leaflet library not loaded');
                    return;
                }

                // Create map centered at Aso Rock, Abuja
                map = L.map(mapContainer).setView([defaultLocation.lat, defaultLocation.lng], 13);

                // Add tile layer
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: ' OpenStreetMap contributors',
                    maxZoom: 19
                }).addTo(map);

                const locationPinIcon = L.icon({
                    iconUrl: 'data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2232%22 height=%2240%22 viewBox=%220 0 32 40%22%3E%3Cpath fill=%22%23dc2626%22 d=%22M16 0C7.2 0 0 7.2 0 16c0 8.8 6.4 16 16 28 9.6-12 16-19.2 16-28C32 7.2 24.8 0 16 0z%22/%3E%3Ccircle cx=%2216%22 cy=%2216%22 r=%226%22 fill=%22%23ffffff%22/%3E%3C/svg%3E',
                    iconSize: [32, 40],
                    iconAnchor: [16, 40],
                    popupAnchor: [0, -34]
                });

                // Add initial location pin + radius circle
                userMarker = L.marker([currentLocation.lat, currentLocation.lng], {
                    draggable: true,
                    icon: locationPinIcon
                }).addTo(map);

                radiusCircle = L.circle([currentLocation.lat, currentLocation.lng], {
                    radius: getRadiusKm() * 1000,
                    color: '#dc2626',
                    fillColor: '#dc2626',
                    fillOpacity: 0.1,
                    weight: 2
                }).addTo(map);

                userMarker.on('dragend', () => {
                    const pos = userMarker.getLatLng();
                    setLocation(pos.lat, pos.lng);
                });

                map.on('click', (event) => {
                    setLocation(event.latlng.lat, event.latlng.lng);
                });

                // Handle geolocation button
                if (geolocateBtn) {
                    geolocateBtn.addEventListener('click', () => {
                        if (navigator.geolocation) {
                            navigator.geolocation.getCurrentPosition((position) => {
                                const lat = position.coords.latitude;
                                const lng = position.coords.longitude;
                                setLocation(lat, lng, 15);
                            });
                        }
                    });
                }

                // Handle location search
                if (locationSearch) {
                    locationSearch.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            const searchTerm = locationSearch.value.trim();
                            if (searchTerm) {
                                // Simple search - in production, use a geocoding API
                                console.log('Searching for:', searchTerm);
                            }
                        }
                    });
                }

                // Handle radius slider
                if (radiusSlider) {
                    radiusSlider.addEventListener('input', () => {
                        updateSliderGradient();
                        updateRadiusCircle();
                    });
                    updateSliderGradient();
                    updateRadiusCircle();
                }
            }
        }

        if (document.getElementById('map-page')) {
            initMapPage();
        }
        
    </script>
</body>
</html>







